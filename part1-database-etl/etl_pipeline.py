{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "312d203b-c20d-4bfd-b315-5b73d064cb29",
   "metadata": {},
   "outputs": [],
   "source": [
    "#import required libraries for extraction, cleaning and loading\n",
    "import pandas as pd\n",
    "import mysql.connector\n",
    "import re"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "77b22f62-ee74-459f-bd53-865e2b207daf",
   "metadata": {},
   "outputs": [],
   "source": [
    "#import data files\n",
    "customers_df = pd.read_csv(\"customers_raw.csv\")\n",
    "products_df  = pd.read_csv(\"products_raw.csv\")\n",
    "sales_df     = pd.read_csv(\"sales_raw.csv\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "7d908abd-0247-4c0f-9c8b-acabdc338390",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>customer_id</th>\n",
       "      <th>first_name</th>\n",
       "      <th>last_name</th>\n",
       "      <th>email</th>\n",
       "      <th>phone</th>\n",
       "      <th>city</th>\n",
       "      <th>registration_date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>C001</td>\n",
       "      <td>Rahul</td>\n",
       "      <td>Sharma</td>\n",
       "      <td>rahul.sharma@gmail.com</td>\n",
       "      <td>+91-9876543210</td>\n",
       "      <td>Bangalore</td>\n",
       "      <td>2023-01-15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>C002</td>\n",
       "      <td>Priya</td>\n",
       "      <td>Patel</td>\n",
       "      <td>priya.patel@yahoo.com</td>\n",
       "      <td>+91-9988776655</td>\n",
       "      <td>Mumbai</td>\n",
       "      <td>2023-02-20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>C004</td>\n",
       "      <td>Sneha</td>\n",
       "      <td>Reddy</td>\n",
       "      <td>sneha.reddy@gmail.com</td>\n",
       "      <td>+91-9123456789</td>\n",
       "      <td>Hyderabad</td>\n",
       "      <td>2023-04-15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>C005</td>\n",
       "      <td>Vikram</td>\n",
       "      <td>Singh</td>\n",
       "      <td>vikram.singh@outlook.com</td>\n",
       "      <td>+91-9988112233</td>\n",
       "      <td>Chennai</td>\n",
       "      <td>2023-05-22</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>C006</td>\n",
       "      <td>Anjali</td>\n",
       "      <td>Mehta</td>\n",
       "      <td>anjali.mehta@gmail.com</td>\n",
       "      <td>+91-9876543210</td>\n",
       "      <td>Bangalore</td>\n",
       "      <td>2023-06-18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>C008</td>\n",
       "      <td>Pooja</td>\n",
       "      <td>Iyer</td>\n",
       "      <td>pooja.iyer@gmail.com</td>\n",
       "      <td>+91-9123456780</td>\n",
       "      <td>Bangalore</td>\n",
       "      <td>2023-08-15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>C009</td>\n",
       "      <td>Karthik</td>\n",
       "      <td>Nair</td>\n",
       "      <td>karthik.nair@yahoo.com</td>\n",
       "      <td>+91-9988776644</td>\n",
       "      <td>Kochi</td>\n",
       "      <td>2023-09-30</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>C010</td>\n",
       "      <td>Deepa</td>\n",
       "      <td>Gupta</td>\n",
       "      <td>deepa.gupta@gmail.com</td>\n",
       "      <td>+91-9871234567</td>\n",
       "      <td>Delhi</td>\n",
       "      <td>2023-10-12</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>C011</td>\n",
       "      <td>Arjun</td>\n",
       "      <td>Rao</td>\n",
       "      <td>arjun.rao@gmail.com</td>\n",
       "      <td>+91-9876509876</td>\n",
       "      <td>Hyderabad</td>\n",
       "      <td>2023-11-05</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>C013</td>\n",
       "      <td>Suresh</td>\n",
       "      <td>Patel</td>\n",
       "      <td>suresh.patel@outlook.com</td>\n",
       "      <td>+91-9123409876</td>\n",
       "      <td>Mumbai</td>\n",
       "      <td>2024-01-08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>C014</td>\n",
       "      <td>Neha</td>\n",
       "      <td>Shah</td>\n",
       "      <td>neha.shah@gmail.com</td>\n",
       "      <td>+91-9876543221</td>\n",
       "      <td>Ahmedabad</td>\n",
       "      <td>2024-01-15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>C015</td>\n",
       "      <td>Manish</td>\n",
       "      <td>Joshi</td>\n",
       "      <td>manish.joshi@yahoo.com</td>\n",
       "      <td>+91-9988776611</td>\n",
       "      <td>Jaipur</td>\n",
       "      <td>2024-01-20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>C016</td>\n",
       "      <td>Divya</td>\n",
       "      <td>Menon</td>\n",
       "      <td>divya.menon@gmail.com</td>\n",
       "      <td>+91-9123456701</td>\n",
       "      <td>Bangalore</td>\n",
       "      <td>2024-02-05</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>C017</td>\n",
       "      <td>Rajesh</td>\n",
       "      <td>Kumar</td>\n",
       "      <td>rajesh.kumar@gmail.com</td>\n",
       "      <td>+91-9876123450</td>\n",
       "      <td>Delhi</td>\n",
       "      <td>2024-02-12</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>C019</td>\n",
       "      <td>Arun</td>\n",
       "      <td>Pillai</td>\n",
       "      <td>arun.pillai@outlook.com</td>\n",
       "      <td>+91-9876543298</td>\n",
       "      <td>Kochi</td>\n",
       "      <td>2024-02-25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>C020</td>\n",
       "      <td>Swati</td>\n",
       "      <td>Desai</td>\n",
       "      <td>swati.desai@gmail.com</td>\n",
       "      <td>+91-9123456712</td>\n",
       "      <td>Pune</td>\n",
       "      <td>2024-03-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>C021</td>\n",
       "      <td>Nikhil</td>\n",
       "      <td>Bose</td>\n",
       "      <td>nikhil.bose@gmail.com</td>\n",
       "      <td>+91-9988776600</td>\n",
       "      <td>Kolkata</td>\n",
       "      <td>2024-03-10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>C022</td>\n",
       "      <td>Priyanka</td>\n",
       "      <td>Jain</td>\n",
       "      <td>priyanka.jain@yahoo.com</td>\n",
       "      <td>+91-9876543287</td>\n",
       "      <td>Indore</td>\n",
       "      <td>2024-03-15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>C024</td>\n",
       "      <td>Meera</td>\n",
       "      <td>Nambiar</td>\n",
       "      <td>meera.nambiar@gmail.com</td>\n",
       "      <td>+91-9123456723</td>\n",
       "      <td>Trivandrum</td>\n",
       "      <td>2024-03-25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>C025</td>\n",
       "      <td>Sanjay</td>\n",
       "      <td>Agarwal</td>\n",
       "      <td>sanjay.agarwal@gmail.com</td>\n",
       "      <td>+91-9876543276</td>\n",
       "      <td>Lucknow</td>\n",
       "      <td>2024-03-28</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   customer_id first_name last_name                     email           phone  \\\n",
       "0         C001      Rahul    Sharma    rahul.sharma@gmail.com  +91-9876543210   \n",
       "1         C002      Priya     Patel     priya.patel@yahoo.com  +91-9988776655   \n",
       "3         C004      Sneha     Reddy     sneha.reddy@gmail.com  +91-9123456789   \n",
       "4         C005     Vikram     Singh  vikram.singh@outlook.com  +91-9988112233   \n",
       "5         C006     Anjali     Mehta    anjali.mehta@gmail.com  +91-9876543210   \n",
       "7         C008      Pooja      Iyer      pooja.iyer@gmail.com  +91-9123456780   \n",
       "8         C009    Karthik      Nair    karthik.nair@yahoo.com  +91-9988776644   \n",
       "9         C010      Deepa     Gupta     deepa.gupta@gmail.com  +91-9871234567   \n",
       "11        C011      Arjun       Rao       arjun.rao@gmail.com  +91-9876509876   \n",
       "13        C013     Suresh     Patel  suresh.patel@outlook.com  +91-9123409876   \n",
       "14        C014       Neha      Shah       neha.shah@gmail.com  +91-9876543221   \n",
       "15        C015     Manish     Joshi    manish.joshi@yahoo.com  +91-9988776611   \n",
       "16        C016      Divya     Menon     divya.menon@gmail.com  +91-9123456701   \n",
       "17        C017     Rajesh     Kumar    rajesh.kumar@gmail.com  +91-9876123450   \n",
       "19        C019       Arun    Pillai   arun.pillai@outlook.com  +91-9876543298   \n",
       "20        C020      Swati     Desai     swati.desai@gmail.com  +91-9123456712   \n",
       "21        C021     Nikhil      Bose     nikhil.bose@gmail.com  +91-9988776600   \n",
       "22        C022   Priyanka      Jain   priyanka.jain@yahoo.com  +91-9876543287   \n",
       "24        C024      Meera   Nambiar   meera.nambiar@gmail.com  +91-9123456723   \n",
       "25        C025     Sanjay   Agarwal  sanjay.agarwal@gmail.com  +91-9876543276   \n",
       "\n",
       "          city registration_date  \n",
       "0    Bangalore        2023-01-15  \n",
       "1       Mumbai        2023-02-20  \n",
       "3    Hyderabad        2023-04-15  \n",
       "4      Chennai        2023-05-22  \n",
       "5    Bangalore        2023-06-18  \n",
       "7    Bangalore        2023-08-15  \n",
       "8        Kochi        2023-09-30  \n",
       "9        Delhi        2023-10-12  \n",
       "11   Hyderabad        2023-11-05  \n",
       "13      Mumbai        2024-01-08  \n",
       "14   Ahmedabad        2024-01-15  \n",
       "15      Jaipur        2024-01-20  \n",
       "16   Bangalore        2024-02-05  \n",
       "17       Delhi        2024-02-12  \n",
       "19       Kochi        2024-02-25  \n",
       "20        Pune        2024-03-01  \n",
       "21     Kolkata        2024-03-10  \n",
       "22      Indore        2024-03-15  \n",
       "24  Trivandrum        2024-03-25  \n",
       "25     Lucknow        2024-03-28  "
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## Customer table ##\n",
    "# Remove duplicate customers\n",
    "customers_df = customers_df.drop_duplicates(subset=[\"customer_id\"])\n",
    "\n",
    "#Drop rows with email as Null to manitain schema provided as \"email VARCHAR(100) UNIQUE NOT NULL\"\n",
    "customers_df = customers_df.dropna(subset=[\"email\"])\n",
    "\n",
    "#Standardizing phone numbers to target format +91-XXXXXXXXXX\n",
    "def normalize_phone(phone):\n",
    "    if pd.isna(phone):\n",
    "        return None\n",
    "    digits = re.sub(r\"\\D\", \"\", phone)\n",
    "    digits = digits[-10:]\n",
    "    return f\"+91-{digits}\"\n",
    "\n",
    "customers_df[\"phone\"] = customers_df[\"phone\"].apply(normalize_phone)\n",
    "\n",
    "#Standardize city names\n",
    "customers_df[\"city\"] = customers_df[\"city\"].str.title()\n",
    "\n",
    "#Standardize Registration Dates\n",
    "def parse_registration_date(date_val):\n",
    "    if pd.isna(date_val):\n",
    "        return pd.NaT\n",
    "\n",
    "    date_str = str(date_val).replace(\"/\", \"-\")\n",
    "\n",
    "    for fmt in (\"%Y-%m-%d\", \"%d-%m-%Y\", \"%m-%d-%Y\"):\n",
    "        try:\n",
    "            return pd.to_datetime(date_str, format=fmt)\n",
    "        except ValueError:\n",
    "            continue\n",
    "\n",
    "    return pd.NaT\n",
    "\n",
    "customers_df[\"registration_date\"] = (\n",
    "    customers_df[\"registration_date\"]\n",
    "    .apply(parse_registration_date)\n",
    "    .dt.date\n",
    ")\n",
    "# Registration dates arrived in mixed formats (YYYY-MM-DD, DD/MM/YYYY, MM-DD-YYYY).\n",
    "#To avoid silent mis-parsing, an explicit multi-format parser was implemented.\n",
    "#Unparseable values are safely coerced to NaT.\n",
    "\n",
    "#Checkinig results\n",
    "customers_df\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "17b98762-27da-4502-88ee-df768609fea7",
   "metadata": {},
   "outputs": [],
   "source": [
    "#------------------------------------------------------------------------------------------------------------------------"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "e5773e0e-f69b-48f9-a93f-52d784b57633",
   "metadata": {},
   "outputs": [],
   "source": [
    "## Products table ##\n",
    "\n",
    "#Remove extra spaces from Product names\n",
    "# While the data does not suggest any issues with names, I normalized product names by removing leading/trailing whitespace and collapsing multiple spaces to prevent dimension duplication.\n",
    "products_df[\"product_name\"] = (\n",
    "    products_df[\"product_name\"]\n",
    "    .astype(str)\n",
    "    .str.strip()\n",
    "    .str.replace(r\"\\s+\", \" \", regex=True)\n",
    ")\n",
    "\n",
    "# Standardize Categories\n",
    "products_df[\"category\"] = (\n",
    "    products_df[\"category\"]\n",
    "    .str.strip()\n",
    "    .str.lower()\n",
    "    .str.title()\n",
    ")\n",
    "\n",
    "# Handle Missing Stock Quantity\n",
    "products_df[\"stock_quantity\"] = products_df[\"stock_quantity\"].fillna(0).astype(int)\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "0ad339e4-48d7-47e6-b850-b10a37c4ea4b",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Price lookup from sales:\n",
      "   product_id  unit_price\n",
      "0        P001     45999.0\n",
      "1        P002      3499.0\n",
      "2        P003     52999.0\n",
      "3        P004      2999.0\n",
      "4        P005      1999.0\n",
      "5        P006       899.0\n",
      "6        P007     52999.0\n",
      "7        P008      1299.0\n",
      "8        P009       650.0\n",
      "9        P010     45999.0\n",
      "10       P011      4599.0\n",
      "11       P012     12999.0\n",
      "12       P013      5499.0\n",
      "13       P014     69999.0\n",
      "14       P015       450.0\n",
      "15       P016     32999.0\n",
      "16       P017      2999.0\n",
      "17       P018       120.0\n",
      "18       P019      1499.0\n",
      "19       P020      1899.0\n",
      "\n",
      "Products with missing prices BEFORE backfill:\n",
      "   product_id       product_name  price\n",
      "2        P003  Apple MacBook Pro    NaN\n",
      "9        P010       OnePlus Nord    NaN\n",
      "16       P017          H&M Shirt    NaN\n",
      "\n",
      "Products with missing prices AFTER backfill:\n",
      "Empty DataFrame\n",
      "Columns: [product_id, product_name, price]\n",
      "Index: []\n",
      "\n",
      "Backfilled product prices:\n",
      "   product_id       product_name    price\n",
      "2        P003  Apple MacBook Pro  52999.0\n",
      "9        P010       OnePlus Nord  45999.0\n",
      "16       P017          H&M Shirt   2999.0\n"
     ]
    }
   ],
   "source": [
    "# Missing prices are being backfilled using sales_df\n",
    "\n",
    "completed_sales = sales_df[sales_df[\"status\"] == \"Completed\"]  # Keep only completed transactions\n",
    "\n",
    "# Derive reliable price per product using median\n",
    "price_lookup = (\n",
    "    completed_sales\n",
    "    .groupby(\"product_id\", as_index=False)[\"unit_price\"]\n",
    "    .median()\n",
    ")\n",
    "\n",
    "print(\"Price lookup from sales:\")\n",
    "print(price_lookup)\n",
    "print(\"\\nProducts with missing prices BEFORE backfill:\")\n",
    "print(products_df[products_df[\"price\"].isna()][[\"product_id\", \"product_name\", \"price\"]])\n",
    "\n",
    "products_enriched_df = products_df.merge( \n",
    "    price_lookup,\n",
    "    on=\"product_id\",\n",
    "    how=\"left\"\n",
    ")  # Merge price lookup into products\n",
    "\n",
    "products_enriched_df[\"price\"] = products_enriched_df[\"price\"].fillna(\n",
    "    products_enriched_df[\"unit_price\"]\n",
    ") # Backfill missing prices\n",
    "\n",
    "products_enriched_df.drop(columns=[\"unit_price\"], inplace=True)  # Cleanup helper column\n",
    "\n",
    "print(\"\\nProducts with missing prices AFTER backfill:\") #Validation\n",
    "print(products_enriched_df[products_enriched_df[\"price\"].isna()][[\"product_id\", \"product_name\", \"price\"]])\n",
    "\n",
    "print(\"\\nBackfilled product prices:\")\n",
    "print(\n",
    "    products_enriched_df[\n",
    "        products_enriched_df[\"product_id\"].isin([\"P003\", \"P010\", \"P017\"])\n",
    "    ][[\"product_id\", \"product_name\", \"price\"]]\n",
    ")\n",
    "products_df=products_enriched_df # referencing the merge data back to products_df. \n",
    "\n",
    "# I enriched the product table by backfilling missing prices using median unit prices from completed sales transactions, keyed on product_id, ensuring accuracy while preserving data completeness."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "669c100f-7af8-46fb-b523-4ca4b93a2bd1",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>product_id</th>\n",
       "      <th>product_name</th>\n",
       "      <th>category</th>\n",
       "      <th>price</th>\n",
       "      <th>stock_quantity</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>P001</td>\n",
       "      <td>Samsung Galaxy S21</td>\n",
       "      <td>Electronics</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>150</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>P002</td>\n",
       "      <td>Nike Running Shoes</td>\n",
       "      <td>Fashion</td>\n",
       "      <td>3499.0</td>\n",
       "      <td>80</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>P003</td>\n",
       "      <td>Apple MacBook Pro</td>\n",
       "      <td>Electronics</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>45</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>P004</td>\n",
       "      <td>Levi's Jeans</td>\n",
       "      <td>Fashion</td>\n",
       "      <td>2999.0</td>\n",
       "      <td>120</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>P005</td>\n",
       "      <td>Sony Headphones</td>\n",
       "      <td>Electronics</td>\n",
       "      <td>1999.0</td>\n",
       "      <td>200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>P006</td>\n",
       "      <td>Organic Almonds</td>\n",
       "      <td>Groceries</td>\n",
       "      <td>899.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>P007</td>\n",
       "      <td>HP Laptop</td>\n",
       "      <td>Electronics</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>60</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>P008</td>\n",
       "      <td>Adidas T-Shirt</td>\n",
       "      <td>Fashion</td>\n",
       "      <td>1299.0</td>\n",
       "      <td>150</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>P009</td>\n",
       "      <td>Basmati Rice 5kg</td>\n",
       "      <td>Groceries</td>\n",
       "      <td>650.0</td>\n",
       "      <td>300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>P010</td>\n",
       "      <td>OnePlus Nord</td>\n",
       "      <td>Electronics</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>95</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>P011</td>\n",
       "      <td>Puma Sneakers</td>\n",
       "      <td>Fashion</td>\n",
       "      <td>4599.0</td>\n",
       "      <td>70</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>P012</td>\n",
       "      <td>Dell Monitor 24inch</td>\n",
       "      <td>Electronics</td>\n",
       "      <td>12999.0</td>\n",
       "      <td>40</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>P013</td>\n",
       "      <td>Woodland Shoes</td>\n",
       "      <td>Fashion</td>\n",
       "      <td>5499.0</td>\n",
       "      <td>55</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>P014</td>\n",
       "      <td>iPhone 13</td>\n",
       "      <td>Electronics</td>\n",
       "      <td>69999.0</td>\n",
       "      <td>80</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>P015</td>\n",
       "      <td>Organic Honey 500g</td>\n",
       "      <td>Groceries</td>\n",
       "      <td>450.0</td>\n",
       "      <td>200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>P016</td>\n",
       "      <td>Samsung TV 43inch</td>\n",
       "      <td>Electronics</td>\n",
       "      <td>32999.0</td>\n",
       "      <td>35</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>P017</td>\n",
       "      <td>H&amp;M Shirt</td>\n",
       "      <td>Fashion</td>\n",
       "      <td>2999.0</td>\n",
       "      <td>90</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>P018</td>\n",
       "      <td>Masoor Dal 1kg</td>\n",
       "      <td>Groceries</td>\n",
       "      <td>120.0</td>\n",
       "      <td>500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>P019</td>\n",
       "      <td>Boat Earbuds</td>\n",
       "      <td>Electronics</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>P020</td>\n",
       "      <td>Reebok Trackpants</td>\n",
       "      <td>Fashion</td>\n",
       "      <td>1899.0</td>\n",
       "      <td>110</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   product_id         product_name     category    price  stock_quantity\n",
       "0        P001   Samsung Galaxy S21  Electronics  45999.0             150\n",
       "1        P002   Nike Running Shoes      Fashion   3499.0              80\n",
       "2        P003    Apple MacBook Pro  Electronics  52999.0              45\n",
       "3        P004         Levi's Jeans      Fashion   2999.0             120\n",
       "4        P005      Sony Headphones  Electronics   1999.0             200\n",
       "5        P006      Organic Almonds    Groceries    899.0               0\n",
       "6        P007            HP Laptop  Electronics  52999.0              60\n",
       "7        P008       Adidas T-Shirt      Fashion   1299.0             150\n",
       "8        P009     Basmati Rice 5kg    Groceries    650.0             300\n",
       "9        P010         OnePlus Nord  Electronics  45999.0              95\n",
       "10       P011        Puma Sneakers      Fashion   4599.0              70\n",
       "11       P012  Dell Monitor 24inch  Electronics  12999.0              40\n",
       "12       P013       Woodland Shoes      Fashion   5499.0              55\n",
       "13       P014            iPhone 13  Electronics  69999.0              80\n",
       "14       P015   Organic Honey 500g    Groceries    450.0             200\n",
       "15       P016    Samsung TV 43inch  Electronics  32999.0              35\n",
       "16       P017            H&M Shirt      Fashion   2999.0              90\n",
       "17       P018       Masoor Dal 1kg    Groceries    120.0             500\n",
       "18       P019         Boat Earbuds  Electronics   1499.0             250\n",
       "19       P020    Reebok Trackpants      Fashion   1899.0             110"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Checking product results\n",
    "products_df\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "08e1215d-739a-402a-b234-59a4db97be50",
   "metadata": {},
   "outputs": [],
   "source": [
    "#----------------------------------------------------------------------------------------------------------------------------"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "93a1a272-0147-4d73-aeac-9f3ac70a0ae9",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>transaction_id</th>\n",
       "      <th>customer_id</th>\n",
       "      <th>product_id</th>\n",
       "      <th>quantity</th>\n",
       "      <th>unit_price</th>\n",
       "      <th>transaction_date</th>\n",
       "      <th>status</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>T001</td>\n",
       "      <td>C001</td>\n",
       "      <td>P001</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>2024-01-15</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>T002</td>\n",
       "      <td>C002</td>\n",
       "      <td>P004</td>\n",
       "      <td>2</td>\n",
       "      <td>2999.0</td>\n",
       "      <td>2024-01-16</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>T003</td>\n",
       "      <td>C003</td>\n",
       "      <td>P007</td>\n",
       "      <td>1</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>2024-01-15</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>T005</td>\n",
       "      <td>C005</td>\n",
       "      <td>P009</td>\n",
       "      <td>3</td>\n",
       "      <td>650.0</td>\n",
       "      <td>2024-01-20</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>T006</td>\n",
       "      <td>C006</td>\n",
       "      <td>P012</td>\n",
       "      <td>1</td>\n",
       "      <td>12999.0</td>\n",
       "      <td>2024-01-22</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>T007</td>\n",
       "      <td>C007</td>\n",
       "      <td>P005</td>\n",
       "      <td>2</td>\n",
       "      <td>1999.0</td>\n",
       "      <td>2024-01-23</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>T009</td>\n",
       "      <td>C009</td>\n",
       "      <td>P011</td>\n",
       "      <td>1</td>\n",
       "      <td>4599.0</td>\n",
       "      <td>2024-01-28</td>\n",
       "      <td>Cancelled</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>T010</td>\n",
       "      <td>C010</td>\n",
       "      <td>P006</td>\n",
       "      <td>5</td>\n",
       "      <td>899.0</td>\n",
       "      <td>2024-02-01</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>T011</td>\n",
       "      <td>C011</td>\n",
       "      <td>P014</td>\n",
       "      <td>1</td>\n",
       "      <td>69999.0</td>\n",
       "      <td>2024-02-02</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>T012</td>\n",
       "      <td>C012</td>\n",
       "      <td>P003</td>\n",
       "      <td>1</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>2024-02-05</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>T013</td>\n",
       "      <td>C013</td>\n",
       "      <td>P015</td>\n",
       "      <td>3</td>\n",
       "      <td>450.0</td>\n",
       "      <td>2024-02-08</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>T014</td>\n",
       "      <td>C014</td>\n",
       "      <td>P019</td>\n",
       "      <td>2</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>2024-10-02</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>T015</td>\n",
       "      <td>C015</td>\n",
       "      <td>P008</td>\n",
       "      <td>3</td>\n",
       "      <td>1299.0</td>\n",
       "      <td>2024-02-12</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>T017</td>\n",
       "      <td>C017</td>\n",
       "      <td>P016</td>\n",
       "      <td>1</td>\n",
       "      <td>32999.0</td>\n",
       "      <td>2024-02-18</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>T018</td>\n",
       "      <td>C018</td>\n",
       "      <td>P020</td>\n",
       "      <td>2</td>\n",
       "      <td>1899.0</td>\n",
       "      <td>2024-02-20</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>T019</td>\n",
       "      <td>C019</td>\n",
       "      <td>P018</td>\n",
       "      <td>10</td>\n",
       "      <td>120.0</td>\n",
       "      <td>2024-02-22</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>T020</td>\n",
       "      <td>C020</td>\n",
       "      <td>P010</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>2024-02-25</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>T021</td>\n",
       "      <td>C021</td>\n",
       "      <td>P017</td>\n",
       "      <td>2</td>\n",
       "      <td>2999.0</td>\n",
       "      <td>2024-02-28</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>T022</td>\n",
       "      <td>C002</td>\n",
       "      <td>P001</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>2024-03-01</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>T023</td>\n",
       "      <td>C003</td>\n",
       "      <td>P019</td>\n",
       "      <td>3</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>2024-02-03</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>T024</td>\n",
       "      <td>C004</td>\n",
       "      <td>P009</td>\n",
       "      <td>5</td>\n",
       "      <td>650.0</td>\n",
       "      <td>2024-03-05</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>T026</td>\n",
       "      <td>C006</td>\n",
       "      <td>P011</td>\n",
       "      <td>1</td>\n",
       "      <td>4599.0</td>\n",
       "      <td>2024-03-10</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>T027</td>\n",
       "      <td>C007</td>\n",
       "      <td>P002</td>\n",
       "      <td>2</td>\n",
       "      <td>3499.0</td>\n",
       "      <td>2024-12-03</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>T028</td>\n",
       "      <td>C008</td>\n",
       "      <td>P015</td>\n",
       "      <td>4</td>\n",
       "      <td>450.0</td>\n",
       "      <td>2024-03-15</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>T029</td>\n",
       "      <td>C009</td>\n",
       "      <td>P007</td>\n",
       "      <td>1</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>2024-03-18</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>T031</td>\n",
       "      <td>C011</td>\n",
       "      <td>P012</td>\n",
       "      <td>1</td>\n",
       "      <td>12999.0</td>\n",
       "      <td>2024-03-22</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>T032</td>\n",
       "      <td>C012</td>\n",
       "      <td>P016</td>\n",
       "      <td>1</td>\n",
       "      <td>32999.0</td>\n",
       "      <td>2024-03-25</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>T033</td>\n",
       "      <td>C013</td>\n",
       "      <td>P005</td>\n",
       "      <td>2</td>\n",
       "      <td>1999.0</td>\n",
       "      <td>2024-03-28</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>T034</td>\n",
       "      <td>C014</td>\n",
       "      <td>P008</td>\n",
       "      <td>2</td>\n",
       "      <td>1299.0</td>\n",
       "      <td>2024-03-30</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35</th>\n",
       "      <td>T035</td>\n",
       "      <td>C015</td>\n",
       "      <td>P018</td>\n",
       "      <td>8</td>\n",
       "      <td>120.0</td>\n",
       "      <td>2024-01-04</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>36</th>\n",
       "      <td>T036</td>\n",
       "      <td>C016</td>\n",
       "      <td>P014</td>\n",
       "      <td>1</td>\n",
       "      <td>69999.0</td>\n",
       "      <td>2024-04-03</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>T037</td>\n",
       "      <td>C017</td>\n",
       "      <td>P006</td>\n",
       "      <td>4</td>\n",
       "      <td>899.0</td>\n",
       "      <td>2024-04-05</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>38</th>\n",
       "      <td>T038</td>\n",
       "      <td>C018</td>\n",
       "      <td>P020</td>\n",
       "      <td>1</td>\n",
       "      <td>1899.0</td>\n",
       "      <td>2024-08-04</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39</th>\n",
       "      <td>T039</td>\n",
       "      <td>C019</td>\n",
       "      <td>P019</td>\n",
       "      <td>2</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>2024-04-10</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40</th>\n",
       "      <td>T040</td>\n",
       "      <td>C020</td>\n",
       "      <td>P013</td>\n",
       "      <td>1</td>\n",
       "      <td>5499.0</td>\n",
       "      <td>2024-04-12</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   transaction_id customer_id product_id  quantity  unit_price  \\\n",
       "0            T001        C001       P001         1     45999.0   \n",
       "1            T002        C002       P004         2      2999.0   \n",
       "2            T003        C003       P007         1     52999.0   \n",
       "4            T005        C005       P009         3       650.0   \n",
       "5            T006        C006       P012         1     12999.0   \n",
       "6            T007        C007       P005         2      1999.0   \n",
       "8            T009        C009       P011         1      4599.0   \n",
       "9            T010        C010       P006         5       899.0   \n",
       "11           T011        C011       P014         1     69999.0   \n",
       "12           T012        C012       P003         1     52999.0   \n",
       "13           T013        C013       P015         3       450.0   \n",
       "14           T014        C014       P019         2      1499.0   \n",
       "15           T015        C015       P008         3      1299.0   \n",
       "17           T017        C017       P016         1     32999.0   \n",
       "18           T018        C018       P020         2      1899.0   \n",
       "19           T019        C019       P018        10       120.0   \n",
       "20           T020        C020       P010         1     45999.0   \n",
       "21           T021        C021       P017         2      2999.0   \n",
       "22           T022        C002       P001         1     45999.0   \n",
       "23           T023        C003       P019         3      1499.0   \n",
       "24           T024        C004       P009         5       650.0   \n",
       "26           T026        C006       P011         1      4599.0   \n",
       "27           T027        C007       P002         2      3499.0   \n",
       "28           T028        C008       P015         4       450.0   \n",
       "29           T029        C009       P007         1     52999.0   \n",
       "31           T031        C011       P012         1     12999.0   \n",
       "32           T032        C012       P016         1     32999.0   \n",
       "33           T033        C013       P005         2      1999.0   \n",
       "34           T034        C014       P008         2      1299.0   \n",
       "35           T035        C015       P018         8       120.0   \n",
       "36           T036        C016       P014         1     69999.0   \n",
       "37           T037        C017       P006         4       899.0   \n",
       "38           T038        C018       P020         1      1899.0   \n",
       "39           T039        C019       P019         2      1499.0   \n",
       "40           T040        C020       P013         1      5499.0   \n",
       "\n",
       "   transaction_date     status  \n",
       "0        2024-01-15  Completed  \n",
       "1        2024-01-16  Completed  \n",
       "2        2024-01-15  Completed  \n",
       "4        2024-01-20  Completed  \n",
       "5        2024-01-22  Completed  \n",
       "6        2024-01-23  Completed  \n",
       "8        2024-01-28  Cancelled  \n",
       "9        2024-02-01  Completed  \n",
       "11       2024-02-02  Completed  \n",
       "12       2024-02-05  Completed  \n",
       "13       2024-02-08  Completed  \n",
       "14       2024-10-02  Completed  \n",
       "15       2024-02-12  Completed  \n",
       "17       2024-02-18  Completed  \n",
       "18       2024-02-20  Completed  \n",
       "19       2024-02-22  Completed  \n",
       "20       2024-02-25  Completed  \n",
       "21       2024-02-28  Completed  \n",
       "22       2024-03-01  Completed  \n",
       "23       2024-02-03  Completed  \n",
       "24       2024-03-05  Completed  \n",
       "26       2024-03-10  Completed  \n",
       "27       2024-12-03  Completed  \n",
       "28       2024-03-15  Completed  \n",
       "29       2024-03-18  Completed  \n",
       "31       2024-03-22  Completed  \n",
       "32       2024-03-25  Completed  \n",
       "33       2024-03-28  Completed  \n",
       "34       2024-03-30  Completed  \n",
       "35       2024-01-04  Completed  \n",
       "36       2024-04-03  Completed  \n",
       "37       2024-04-05  Completed  \n",
       "38       2024-08-04  Completed  \n",
       "39       2024-04-10  Completed  \n",
       "40       2024-04-12  Completed  "
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## Sales table ##\n",
    "# Remove duplicate transations\n",
    "sales_df = sales_df.drop_duplicates(subset=[\"transaction_id\"])\n",
    "\n",
    "#Handle Missing Customer_ids and product_ids aka Foreign Keys by dropping records to preserve referential integrity\n",
    "sales_df = sales_df.dropna(subset=[\"customer_id\", \"product_id\"])\n",
    "\n",
    "#Standardize Transaction Dates\n",
    "def parse_transaction_date(date_val):\n",
    "    if pd.isna(date_val):\n",
    "        return pd.NaT\n",
    "\n",
    "    date_str = str(date_val).replace(\"/\", \"-\")\n",
    "\n",
    "    for fmt in (\"%Y-%m-%d\", \"%d-%m-%Y\", \"%m-%d-%Y\"):\n",
    "        try:\n",
    "            return pd.to_datetime(date_str, format=fmt)\n",
    "        except ValueError:\n",
    "            continue\n",
    "\n",
    "    return pd.NaT\n",
    "\n",
    "sales_df[\"transaction_date\"] = (\n",
    "    sales_df[\"transaction_date\"]\n",
    "    .apply(parse_registration_date)\n",
    "    .dt.date\n",
    ")\n",
    "\n",
    "#Checking results\n",
    "sales_df\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "a52c59a2-3ce5-496d-95c8-7a42c058b9e0",
   "metadata": {},
   "outputs": [],
   "source": [
    "#-----------------------------------------------------------------------------------"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "8e19e222-72e9-49e7-860b-ce3d3a5ee43e",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Add surrogate keys (auto-incrementing IDs)\n",
    "#Surrogate keys are being implemented using database-managed AUTO_INCREMENT primary keys in the provided schema. \n",
    "#During the ETL process, natural keys from source files (e.g., customer_id C001, product_id P001) will not be loaded into the target schema. \n",
    "#After inserting dimension records, the ETL pipeline retrieves generated surrogate keys and maps them to fact records, ensuring referential integrity while decoupling analytical identifiers from source system dependencies."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "da6abbf1-9ebb-401f-9856-8a094c7a93e2",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Creating Database Fleximart in MySQl based on the provided schema"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1d74564e-9c6a-40af-b3b2-e73888d91be1",
   "metadata": {},
   "outputs": [],
   "source": [
    "#-----------------------------------------------------------------------------------"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 94,
   "id": "b3a24f51-29d3-4e04-beb9-eae150dd132d",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "✅ Connected to MySQL successfully\n"
     ]
    }
   ],
   "source": [
    "## Loading clean data into Fleximart database ##\n",
    "\n",
    "#Establishing database connection\n",
    "from sqlalchemy import create_engine\n",
    "from urllib.parse import quote_plus\n",
    "\n",
    "pwd = quote_plus(\"Am@007za\")\n",
    "engine = create_engine(\n",
    "    f\"mysql+pymysql://root:{pwd}@localhost:3306/fleximart\"\n",
    ")\n",
    "\n",
    "#Verifying connection\n",
    "with engine.connect() as conn:\n",
    "    print(\"✅ Connected to MySQL successfully\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "b495dbef-b31a-48d5-8a75-f9fe68b3de39",
   "metadata": {},
   "outputs": [
    {
     "ename": "IntegrityError",
     "evalue": "(pymysql.err.IntegrityError) (1062, \"Duplicate entry 'rahul.sharma@gmail.com' for key 'customers.email'\")\n[SQL: INSERT INTO customers (first_name, last_name, email, phone, city, registration_date) VALUES (%(first_name)s, %(last_name)s, %(email)s, %(phone)s, %(city)s, %(registration_date)s)]\n[parameters: [{'first_name': 'Rahul', 'last_name': 'Sharma', 'email': 'rahul.sharma@gmail.com', 'phone': '+91-9876543210', 'city': 'Bangalore', 'registration_date': datetime.date(2023, 1, 15)}, {'first_name': 'Priya', 'last_name': 'Patel', 'email': 'priya.patel@yahoo.com', 'phone': '+91-9988776655', 'city': 'Mumbai', 'registration_date': datetime.date(2023, 2, 20)}, {'first_name': 'Sneha', 'last_name': 'Reddy', 'email': 'sneha.reddy@gmail.com', 'phone': '+91-9123456789', 'city': 'Hyderabad', 'registration_date': datetime.date(2023, 4, 15)}, {'first_name': 'Vikram', 'last_name': 'Singh', 'email': 'vikram.singh@outlook.com', 'phone': '+91-9988112233', 'city': 'Chennai', 'registration_date': datetime.date(2023, 5, 22)}, {'first_name': 'Anjali', 'last_name': 'Mehta', 'email': 'anjali.mehta@gmail.com', 'phone': '+91-9876543210', 'city': 'Bangalore', 'registration_date': datetime.date(2023, 6, 18)}, {'first_name': 'Pooja', 'last_name': 'Iyer', 'email': 'pooja.iyer@gmail.com', 'phone': '+91-9123456780', 'city': 'Bangalore', 'registration_date': datetime.date(2023, 8, 15)}, {'first_name': 'Karthik', 'last_name': 'Nair', 'email': 'karthik.nair@yahoo.com', 'phone': '+91-9988776644', 'city': 'Kochi', 'registration_date': datetime.date(2023, 9, 30)}, {'first_name': 'Deepa', 'last_name': 'Gupta', 'email': 'deepa.gupta@gmail.com', 'phone': '+91-9871234567', 'city': 'Delhi', 'registration_date': datetime.date(2023, 10, 12)}  ... displaying 10 of 20 total bound parameter sets ...  {'first_name': 'Meera', 'last_name': 'Nambiar', 'email': 'meera.nambiar@gmail.com', 'phone': '+91-9123456723', 'city': 'Trivandrum', 'registration_date': datetime.date(2024, 3, 25)}, {'first_name': 'Sanjay', 'last_name': 'Agarwal', 'email': 'sanjay.agarwal@gmail.com', 'phone': '+91-9876543276', 'city': 'Lucknow', 'registration_date': datetime.date(2024, 3, 28)}]]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mIntegrityError\u001b[0m                            Traceback (most recent call last)",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\sqlalchemy\\engine\\base.py:1936\u001b[0m, in \u001b[0;36mConnection._exec_single_context\u001b[1;34m(self, dialect, context, statement, parameters)\u001b[0m\n\u001b[0;32m   1935\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m evt_handled:\n\u001b[1;32m-> 1936\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mdialect\u001b[38;5;241m.\u001b[39mdo_executemany(\n\u001b[0;32m   1937\u001b[0m             cursor,\n\u001b[0;32m   1938\u001b[0m             str_statement,\n\u001b[0;32m   1939\u001b[0m             effective_parameters,\n\u001b[0;32m   1940\u001b[0m             context,\n\u001b[0;32m   1941\u001b[0m         )\n\u001b[0;32m   1942\u001b[0m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m effective_parameters \u001b[38;5;129;01mand\u001b[39;00m context\u001b[38;5;241m.\u001b[39mno_parameters:\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\sqlalchemy\\dialects\\mysql\\mysqldb.py:170\u001b[0m, in \u001b[0;36mMySQLDialect_mysqldb.do_executemany\u001b[1;34m(self, cursor, statement, parameters, context)\u001b[0m\n\u001b[0;32m    169\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21mdo_executemany\u001b[39m(\u001b[38;5;28mself\u001b[39m, cursor, statement, parameters, context\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mNone\u001b[39;00m):\n\u001b[1;32m--> 170\u001b[0m     rowcount \u001b[38;5;241m=\u001b[39m cursor\u001b[38;5;241m.\u001b[39mexecutemany(statement, parameters)\n\u001b[0;32m    171\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m context \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\cursors.py:182\u001b[0m, in \u001b[0;36mCursor.executemany\u001b[1;34m(self, query, args)\u001b[0m\n\u001b[0;32m    181\u001b[0m     \u001b[38;5;28;01massert\u001b[39;00m q_values[\u001b[38;5;241m0\u001b[39m] \u001b[38;5;241m==\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m(\u001b[39m\u001b[38;5;124m\"\u001b[39m \u001b[38;5;129;01mand\u001b[39;00m q_values[\u001b[38;5;241m-\u001b[39m\u001b[38;5;241m1\u001b[39m] \u001b[38;5;241m==\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m)\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[1;32m--> 182\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_do_execute_many(\n\u001b[0;32m    183\u001b[0m         q_prefix,\n\u001b[0;32m    184\u001b[0m         q_values,\n\u001b[0;32m    185\u001b[0m         q_postfix,\n\u001b[0;32m    186\u001b[0m         args,\n\u001b[0;32m    187\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mmax_stmt_length,\n\u001b[0;32m    188\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_get_db()\u001b[38;5;241m.\u001b[39mencoding,\n\u001b[0;32m    189\u001b[0m     )\n\u001b[0;32m    191\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mrowcount \u001b[38;5;241m=\u001b[39m \u001b[38;5;28msum\u001b[39m(\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mexecute(query, arg) \u001b[38;5;28;01mfor\u001b[39;00m arg \u001b[38;5;129;01min\u001b[39;00m args)\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\cursors.py:220\u001b[0m, in \u001b[0;36mCursor._do_execute_many\u001b[1;34m(self, prefix, values, postfix, args, max_stmt_length, encoding)\u001b[0m\n\u001b[0;32m    219\u001b[0m     sql \u001b[38;5;241m+\u001b[39m\u001b[38;5;241m=\u001b[39m v\n\u001b[1;32m--> 220\u001b[0m rows \u001b[38;5;241m+\u001b[39m\u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mexecute(sql \u001b[38;5;241m+\u001b[39m postfix)\n\u001b[0;32m    221\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mrowcount \u001b[38;5;241m=\u001b[39m rows\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\cursors.py:153\u001b[0m, in \u001b[0;36mCursor.execute\u001b[1;34m(self, query, args)\u001b[0m\n\u001b[0;32m    151\u001b[0m query \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mmogrify(query, args)\n\u001b[1;32m--> 153\u001b[0m result \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_query(query)\n\u001b[0;32m    154\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_executed \u001b[38;5;241m=\u001b[39m query\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\cursors.py:322\u001b[0m, in \u001b[0;36mCursor._query\u001b[1;34m(self, q)\u001b[0m\n\u001b[0;32m    321\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_clear_result()\n\u001b[1;32m--> 322\u001b[0m conn\u001b[38;5;241m.\u001b[39mquery(q)\n\u001b[0;32m    323\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_do_get_result()\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\connections.py:563\u001b[0m, in \u001b[0;36mConnection.query\u001b[1;34m(self, sql, unbuffered)\u001b[0m\n\u001b[0;32m    562\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_execute_command(COMMAND\u001b[38;5;241m.\u001b[39mCOM_QUERY, sql)\n\u001b[1;32m--> 563\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_affected_rows \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_read_query_result(unbuffered\u001b[38;5;241m=\u001b[39munbuffered)\n\u001b[0;32m    564\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_affected_rows\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\connections.py:825\u001b[0m, in \u001b[0;36mConnection._read_query_result\u001b[1;34m(self, unbuffered)\u001b[0m\n\u001b[0;32m    824\u001b[0m     result \u001b[38;5;241m=\u001b[39m MySQLResult(\u001b[38;5;28mself\u001b[39m)\n\u001b[1;32m--> 825\u001b[0m     result\u001b[38;5;241m.\u001b[39mread()\n\u001b[0;32m    826\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_result \u001b[38;5;241m=\u001b[39m result\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\connections.py:1199\u001b[0m, in \u001b[0;36mMySQLResult.read\u001b[1;34m(self)\u001b[0m\n\u001b[0;32m   1198\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[1;32m-> 1199\u001b[0m     first_packet \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mconnection\u001b[38;5;241m.\u001b[39m_read_packet()\n\u001b[0;32m   1201\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m first_packet\u001b[38;5;241m.\u001b[39mis_ok_packet():\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\connections.py:775\u001b[0m, in \u001b[0;36mConnection._read_packet\u001b[1;34m(self, packet_type)\u001b[0m\n\u001b[0;32m    774\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_result\u001b[38;5;241m.\u001b[39munbuffered_active \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;01mFalse\u001b[39;00m\n\u001b[1;32m--> 775\u001b[0m     packet\u001b[38;5;241m.\u001b[39mraise_for_error()\n\u001b[0;32m    776\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m packet\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\protocol.py:219\u001b[0m, in \u001b[0;36mMysqlPacket.raise_for_error\u001b[1;34m(self)\u001b[0m\n\u001b[0;32m    218\u001b[0m     \u001b[38;5;28mprint\u001b[39m(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124merrno =\u001b[39m\u001b[38;5;124m\"\u001b[39m, errno)\n\u001b[1;32m--> 219\u001b[0m err\u001b[38;5;241m.\u001b[39mraise_mysql_exception(\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_data)\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\err.py:150\u001b[0m, in \u001b[0;36mraise_mysql_exception\u001b[1;34m(data)\u001b[0m\n\u001b[0;32m    149\u001b[0m     errorclass \u001b[38;5;241m=\u001b[39m InternalError \u001b[38;5;28;01mif\u001b[39;00m errno \u001b[38;5;241m<\u001b[39m \u001b[38;5;241m1000\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m OperationalError\n\u001b[1;32m--> 150\u001b[0m \u001b[38;5;28;01mraise\u001b[39;00m errorclass(errno, errval)\n",
      "\u001b[1;31mIntegrityError\u001b[0m: (1062, \"Duplicate entry 'rahul.sharma@gmail.com' for key 'customers.email'\")",
      "\nThe above exception was the direct cause of the following exception:\n",
      "\u001b[1;31mIntegrityError\u001b[0m                            Traceback (most recent call last)",
      "Cell \u001b[1;32mIn[10], line 5\u001b[0m\n\u001b[0;32m      1\u001b[0m \u001b[38;5;66;03m# Loading Customer table\u001b[39;00m\n\u001b[0;32m      2\u001b[0m customers_df[[\n\u001b[0;32m      3\u001b[0m     \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mfirst_name\u001b[39m\u001b[38;5;124m\"\u001b[39m, \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mlast_name\u001b[39m\u001b[38;5;124m\"\u001b[39m, \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124memail\u001b[39m\u001b[38;5;124m\"\u001b[39m,\n\u001b[0;32m      4\u001b[0m     \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mphone\u001b[39m\u001b[38;5;124m\"\u001b[39m, \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mcity\u001b[39m\u001b[38;5;124m\"\u001b[39m, \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mregistration_date\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[1;32m----> 5\u001b[0m ]]\u001b[38;5;241m.\u001b[39mto_sql(\n\u001b[0;32m      6\u001b[0m     \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mcustomers\u001b[39m\u001b[38;5;124m\"\u001b[39m,\n\u001b[0;32m      7\u001b[0m     con\u001b[38;5;241m=\u001b[39mengine,\n\u001b[0;32m      8\u001b[0m     if_exists\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mappend\u001b[39m\u001b[38;5;124m\"\u001b[39m,\n\u001b[0;32m      9\u001b[0m     index\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mFalse\u001b[39;00m\n\u001b[0;32m     10\u001b[0m )\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pandas\\util\\_decorators.py:333\u001b[0m, in \u001b[0;36mdeprecate_nonkeyword_arguments.<locals>.decorate.<locals>.wrapper\u001b[1;34m(*args, **kwargs)\u001b[0m\n\u001b[0;32m    327\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(args) \u001b[38;5;241m>\u001b[39m num_allow_args:\n\u001b[0;32m    328\u001b[0m     warnings\u001b[38;5;241m.\u001b[39mwarn(\n\u001b[0;32m    329\u001b[0m         msg\u001b[38;5;241m.\u001b[39mformat(arguments\u001b[38;5;241m=\u001b[39m_format_argument_list(allow_args)),\n\u001b[0;32m    330\u001b[0m         \u001b[38;5;167;01mFutureWarning\u001b[39;00m,\n\u001b[0;32m    331\u001b[0m         stacklevel\u001b[38;5;241m=\u001b[39mfind_stack_level(),\n\u001b[0;32m    332\u001b[0m     )\n\u001b[1;32m--> 333\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m func(\u001b[38;5;241m*\u001b[39margs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs)\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pandas\\core\\generic.py:3087\u001b[0m, in \u001b[0;36mNDFrame.to_sql\u001b[1;34m(self, name, con, schema, if_exists, index, index_label, chunksize, dtype, method)\u001b[0m\n\u001b[0;32m   2889\u001b[0m \u001b[38;5;250m\u001b[39m\u001b[38;5;124;03m\"\"\"\u001b[39;00m\n\u001b[0;32m   2890\u001b[0m \u001b[38;5;124;03mWrite records stored in a DataFrame to a SQL database.\u001b[39;00m\n\u001b[0;32m   2891\u001b[0m \n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m   3083\u001b[0m \u001b[38;5;124;03m[(1,), (None,), (2,)]\u001b[39;00m\n\u001b[0;32m   3084\u001b[0m \u001b[38;5;124;03m\"\"\"\u001b[39;00m  \u001b[38;5;66;03m# noqa: E501\u001b[39;00m\n\u001b[0;32m   3085\u001b[0m \u001b[38;5;28;01mfrom\u001b[39;00m \u001b[38;5;21;01mpandas\u001b[39;00m\u001b[38;5;21;01m.\u001b[39;00m\u001b[38;5;21;01mio\u001b[39;00m \u001b[38;5;28;01mimport\u001b[39;00m sql\n\u001b[1;32m-> 3087\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m sql\u001b[38;5;241m.\u001b[39mto_sql(\n\u001b[0;32m   3088\u001b[0m     \u001b[38;5;28mself\u001b[39m,\n\u001b[0;32m   3089\u001b[0m     name,\n\u001b[0;32m   3090\u001b[0m     con,\n\u001b[0;32m   3091\u001b[0m     schema\u001b[38;5;241m=\u001b[39mschema,\n\u001b[0;32m   3092\u001b[0m     if_exists\u001b[38;5;241m=\u001b[39mif_exists,\n\u001b[0;32m   3093\u001b[0m     index\u001b[38;5;241m=\u001b[39mindex,\n\u001b[0;32m   3094\u001b[0m     index_label\u001b[38;5;241m=\u001b[39mindex_label,\n\u001b[0;32m   3095\u001b[0m     chunksize\u001b[38;5;241m=\u001b[39mchunksize,\n\u001b[0;32m   3096\u001b[0m     dtype\u001b[38;5;241m=\u001b[39mdtype,\n\u001b[0;32m   3097\u001b[0m     method\u001b[38;5;241m=\u001b[39mmethod,\n\u001b[0;32m   3098\u001b[0m )\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pandas\\io\\sql.py:842\u001b[0m, in \u001b[0;36mto_sql\u001b[1;34m(frame, name, con, schema, if_exists, index, index_label, chunksize, dtype, method, engine, **engine_kwargs)\u001b[0m\n\u001b[0;32m    837\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mNotImplementedError\u001b[39;00m(\n\u001b[0;32m    838\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mframe\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124m argument should be either a Series or a DataFrame\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[0;32m    839\u001b[0m     )\n\u001b[0;32m    841\u001b[0m \u001b[38;5;28;01mwith\u001b[39;00m pandasSQL_builder(con, schema\u001b[38;5;241m=\u001b[39mschema, need_transaction\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mTrue\u001b[39;00m) \u001b[38;5;28;01mas\u001b[39;00m pandas_sql:\n\u001b[1;32m--> 842\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m pandas_sql\u001b[38;5;241m.\u001b[39mto_sql(\n\u001b[0;32m    843\u001b[0m         frame,\n\u001b[0;32m    844\u001b[0m         name,\n\u001b[0;32m    845\u001b[0m         if_exists\u001b[38;5;241m=\u001b[39mif_exists,\n\u001b[0;32m    846\u001b[0m         index\u001b[38;5;241m=\u001b[39mindex,\n\u001b[0;32m    847\u001b[0m         index_label\u001b[38;5;241m=\u001b[39mindex_label,\n\u001b[0;32m    848\u001b[0m         schema\u001b[38;5;241m=\u001b[39mschema,\n\u001b[0;32m    849\u001b[0m         chunksize\u001b[38;5;241m=\u001b[39mchunksize,\n\u001b[0;32m    850\u001b[0m         dtype\u001b[38;5;241m=\u001b[39mdtype,\n\u001b[0;32m    851\u001b[0m         method\u001b[38;5;241m=\u001b[39mmethod,\n\u001b[0;32m    852\u001b[0m         engine\u001b[38;5;241m=\u001b[39mengine,\n\u001b[0;32m    853\u001b[0m         \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mengine_kwargs,\n\u001b[0;32m    854\u001b[0m     )\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pandas\\io\\sql.py:2018\u001b[0m, in \u001b[0;36mSQLDatabase.to_sql\u001b[1;34m(self, frame, name, if_exists, index, index_label, schema, chunksize, dtype, method, engine, **engine_kwargs)\u001b[0m\n\u001b[0;32m   2006\u001b[0m sql_engine \u001b[38;5;241m=\u001b[39m get_engine(engine)\n\u001b[0;32m   2008\u001b[0m table \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mprep_table(\n\u001b[0;32m   2009\u001b[0m     frame\u001b[38;5;241m=\u001b[39mframe,\n\u001b[0;32m   2010\u001b[0m     name\u001b[38;5;241m=\u001b[39mname,\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m   2015\u001b[0m     dtype\u001b[38;5;241m=\u001b[39mdtype,\n\u001b[0;32m   2016\u001b[0m )\n\u001b[1;32m-> 2018\u001b[0m total_inserted \u001b[38;5;241m=\u001b[39m sql_engine\u001b[38;5;241m.\u001b[39minsert_records(\n\u001b[0;32m   2019\u001b[0m     table\u001b[38;5;241m=\u001b[39mtable,\n\u001b[0;32m   2020\u001b[0m     con\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mcon,\n\u001b[0;32m   2021\u001b[0m     frame\u001b[38;5;241m=\u001b[39mframe,\n\u001b[0;32m   2022\u001b[0m     name\u001b[38;5;241m=\u001b[39mname,\n\u001b[0;32m   2023\u001b[0m     index\u001b[38;5;241m=\u001b[39mindex,\n\u001b[0;32m   2024\u001b[0m     schema\u001b[38;5;241m=\u001b[39mschema,\n\u001b[0;32m   2025\u001b[0m     chunksize\u001b[38;5;241m=\u001b[39mchunksize,\n\u001b[0;32m   2026\u001b[0m     method\u001b[38;5;241m=\u001b[39mmethod,\n\u001b[0;32m   2027\u001b[0m     \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mengine_kwargs,\n\u001b[0;32m   2028\u001b[0m )\n\u001b[0;32m   2030\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mcheck_case_sensitive(name\u001b[38;5;241m=\u001b[39mname, schema\u001b[38;5;241m=\u001b[39mschema)\n\u001b[0;32m   2031\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m total_inserted\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pandas\\io\\sql.py:1567\u001b[0m, in \u001b[0;36mSQLAlchemyEngine.insert_records\u001b[1;34m(self, table, con, frame, name, index, schema, chunksize, method, **engine_kwargs)\u001b[0m\n\u001b[0;32m   1565\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m re\u001b[38;5;241m.\u001b[39msearch(msg, err_text):\n\u001b[0;32m   1566\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mValueError\u001b[39;00m(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124minf cannot be used with MySQL\u001b[39m\u001b[38;5;124m\"\u001b[39m) \u001b[38;5;28;01mfrom\u001b[39;00m \u001b[38;5;21;01merr\u001b[39;00m\n\u001b[1;32m-> 1567\u001b[0m \u001b[38;5;28;01mraise\u001b[39;00m err\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pandas\\io\\sql.py:1558\u001b[0m, in \u001b[0;36mSQLAlchemyEngine.insert_records\u001b[1;34m(self, table, con, frame, name, index, schema, chunksize, method, **engine_kwargs)\u001b[0m\n\u001b[0;32m   1555\u001b[0m \u001b[38;5;28;01mfrom\u001b[39;00m \u001b[38;5;21;01msqlalchemy\u001b[39;00m \u001b[38;5;28;01mimport\u001b[39;00m exc\n\u001b[0;32m   1557\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[1;32m-> 1558\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m table\u001b[38;5;241m.\u001b[39minsert(chunksize\u001b[38;5;241m=\u001b[39mchunksize, method\u001b[38;5;241m=\u001b[39mmethod)\n\u001b[0;32m   1559\u001b[0m \u001b[38;5;28;01mexcept\u001b[39;00m exc\u001b[38;5;241m.\u001b[39mStatementError \u001b[38;5;28;01mas\u001b[39;00m err:\n\u001b[0;32m   1560\u001b[0m     \u001b[38;5;66;03m# GH34431\u001b[39;00m\n\u001b[0;32m   1561\u001b[0m     \u001b[38;5;66;03m# https://stackoverflow.com/a/67358288/6067848\u001b[39;00m\n\u001b[0;32m   1562\u001b[0m     msg \u001b[38;5;241m=\u001b[39m \u001b[38;5;124mr\u001b[39m\u001b[38;5;124m\"\"\"\u001b[39m\u001b[38;5;124m(\u001b[39m\u001b[38;5;124m\\\u001b[39m\u001b[38;5;124m(1054, \u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mUnknown column \u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124minf(e0)?\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124m in \u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mfield list\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m\\\u001b[39m\u001b[38;5;124m))(?#\u001b[39m\n\u001b[0;32m   1563\u001b[0m \u001b[38;5;124m    )|inf can not be used with MySQL\u001b[39m\u001b[38;5;124m\"\"\"\u001b[39m\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pandas\\io\\sql.py:1119\u001b[0m, in \u001b[0;36mSQLTable.insert\u001b[1;34m(self, chunksize, method)\u001b[0m\n\u001b[0;32m   1116\u001b[0m     \u001b[38;5;28;01mbreak\u001b[39;00m\n\u001b[0;32m   1118\u001b[0m chunk_iter \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mzip\u001b[39m(\u001b[38;5;241m*\u001b[39m(arr[start_i:end_i] \u001b[38;5;28;01mfor\u001b[39;00m arr \u001b[38;5;129;01min\u001b[39;00m data_list))\n\u001b[1;32m-> 1119\u001b[0m num_inserted \u001b[38;5;241m=\u001b[39m exec_insert(conn, keys, chunk_iter)\n\u001b[0;32m   1120\u001b[0m \u001b[38;5;66;03m# GH 46891\u001b[39;00m\n\u001b[0;32m   1121\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m num_inserted \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pandas\\io\\sql.py:1010\u001b[0m, in \u001b[0;36mSQLTable._execute_insert\u001b[1;34m(self, conn, keys, data_iter)\u001b[0m\n\u001b[0;32m    998\u001b[0m \u001b[38;5;250m\u001b[39m\u001b[38;5;124;03m\"\"\"\u001b[39;00m\n\u001b[0;32m    999\u001b[0m \u001b[38;5;124;03mExecute SQL statement inserting data\u001b[39;00m\n\u001b[0;32m   1000\u001b[0m \n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m   1007\u001b[0m \u001b[38;5;124;03m   Each item contains a list of values to be inserted\u001b[39;00m\n\u001b[0;32m   1008\u001b[0m \u001b[38;5;124;03m\"\"\"\u001b[39;00m\n\u001b[0;32m   1009\u001b[0m data \u001b[38;5;241m=\u001b[39m [\u001b[38;5;28mdict\u001b[39m(\u001b[38;5;28mzip\u001b[39m(keys, row)) \u001b[38;5;28;01mfor\u001b[39;00m row \u001b[38;5;129;01min\u001b[39;00m data_iter]\n\u001b[1;32m-> 1010\u001b[0m result \u001b[38;5;241m=\u001b[39m conn\u001b[38;5;241m.\u001b[39mexecute(\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mtable\u001b[38;5;241m.\u001b[39minsert(), data)\n\u001b[0;32m   1011\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m result\u001b[38;5;241m.\u001b[39mrowcount\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\sqlalchemy\\engine\\base.py:1418\u001b[0m, in \u001b[0;36mConnection.execute\u001b[1;34m(self, statement, parameters, execution_options)\u001b[0m\n\u001b[0;32m   1416\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m exc\u001b[38;5;241m.\u001b[39mObjectNotExecutableError(statement) \u001b[38;5;28;01mfrom\u001b[39;00m \u001b[38;5;21;01merr\u001b[39;00m\n\u001b[0;32m   1417\u001b[0m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[1;32m-> 1418\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m meth(\n\u001b[0;32m   1419\u001b[0m         \u001b[38;5;28mself\u001b[39m,\n\u001b[0;32m   1420\u001b[0m         distilled_parameters,\n\u001b[0;32m   1421\u001b[0m         execution_options \u001b[38;5;129;01mor\u001b[39;00m NO_OPTIONS,\n\u001b[0;32m   1422\u001b[0m     )\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py:515\u001b[0m, in \u001b[0;36mClauseElement._execute_on_connection\u001b[1;34m(self, connection, distilled_params, execution_options)\u001b[0m\n\u001b[0;32m    513\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m TYPE_CHECKING:\n\u001b[0;32m    514\u001b[0m         \u001b[38;5;28;01massert\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(\u001b[38;5;28mself\u001b[39m, Executable)\n\u001b[1;32m--> 515\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m connection\u001b[38;5;241m.\u001b[39m_execute_clauseelement(\n\u001b[0;32m    516\u001b[0m         \u001b[38;5;28mself\u001b[39m, distilled_params, execution_options\n\u001b[0;32m    517\u001b[0m     )\n\u001b[0;32m    518\u001b[0m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[0;32m    519\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m exc\u001b[38;5;241m.\u001b[39mObjectNotExecutableError(\u001b[38;5;28mself\u001b[39m)\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\sqlalchemy\\engine\\base.py:1640\u001b[0m, in \u001b[0;36mConnection._execute_clauseelement\u001b[1;34m(self, elem, distilled_parameters, execution_options)\u001b[0m\n\u001b[0;32m   1628\u001b[0m compiled_cache: Optional[CompiledCacheType] \u001b[38;5;241m=\u001b[39m execution_options\u001b[38;5;241m.\u001b[39mget(\n\u001b[0;32m   1629\u001b[0m     \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mcompiled_cache\u001b[39m\u001b[38;5;124m\"\u001b[39m, \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mengine\u001b[38;5;241m.\u001b[39m_compiled_cache\n\u001b[0;32m   1630\u001b[0m )\n\u001b[0;32m   1632\u001b[0m compiled_sql, extracted_params, cache_hit \u001b[38;5;241m=\u001b[39m elem\u001b[38;5;241m.\u001b[39m_compile_w_cache(\n\u001b[0;32m   1633\u001b[0m     dialect\u001b[38;5;241m=\u001b[39mdialect,\n\u001b[0;32m   1634\u001b[0m     compiled_cache\u001b[38;5;241m=\u001b[39mcompiled_cache,\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m   1638\u001b[0m     linting\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mdialect\u001b[38;5;241m.\u001b[39mcompiler_linting \u001b[38;5;241m|\u001b[39m compiler\u001b[38;5;241m.\u001b[39mWARN_LINTING,\n\u001b[0;32m   1639\u001b[0m )\n\u001b[1;32m-> 1640\u001b[0m ret \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_execute_context(\n\u001b[0;32m   1641\u001b[0m     dialect,\n\u001b[0;32m   1642\u001b[0m     dialect\u001b[38;5;241m.\u001b[39mexecution_ctx_cls\u001b[38;5;241m.\u001b[39m_init_compiled,\n\u001b[0;32m   1643\u001b[0m     compiled_sql,\n\u001b[0;32m   1644\u001b[0m     distilled_parameters,\n\u001b[0;32m   1645\u001b[0m     execution_options,\n\u001b[0;32m   1646\u001b[0m     compiled_sql,\n\u001b[0;32m   1647\u001b[0m     distilled_parameters,\n\u001b[0;32m   1648\u001b[0m     elem,\n\u001b[0;32m   1649\u001b[0m     extracted_params,\n\u001b[0;32m   1650\u001b[0m     cache_hit\u001b[38;5;241m=\u001b[39mcache_hit,\n\u001b[0;32m   1651\u001b[0m )\n\u001b[0;32m   1652\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m has_events:\n\u001b[0;32m   1653\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mdispatch\u001b[38;5;241m.\u001b[39mafter_execute(\n\u001b[0;32m   1654\u001b[0m         \u001b[38;5;28mself\u001b[39m,\n\u001b[0;32m   1655\u001b[0m         elem,\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m   1659\u001b[0m         ret,\n\u001b[0;32m   1660\u001b[0m     )\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\sqlalchemy\\engine\\base.py:1846\u001b[0m, in \u001b[0;36mConnection._execute_context\u001b[1;34m(self, dialect, constructor, statement, parameters, execution_options, *args, **kw)\u001b[0m\n\u001b[0;32m   1844\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_exec_insertmany_context(dialect, context)\n\u001b[0;32m   1845\u001b[0m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[1;32m-> 1846\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_exec_single_context(\n\u001b[0;32m   1847\u001b[0m         dialect, context, statement, parameters\n\u001b[0;32m   1848\u001b[0m     )\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\sqlalchemy\\engine\\base.py:1986\u001b[0m, in \u001b[0;36mConnection._exec_single_context\u001b[1;34m(self, dialect, context, statement, parameters)\u001b[0m\n\u001b[0;32m   1983\u001b[0m     result \u001b[38;5;241m=\u001b[39m context\u001b[38;5;241m.\u001b[39m_setup_result_proxy()\n\u001b[0;32m   1985\u001b[0m \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mBaseException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m e:\n\u001b[1;32m-> 1986\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_handle_dbapi_exception(\n\u001b[0;32m   1987\u001b[0m         e, str_statement, effective_parameters, cursor, context\n\u001b[0;32m   1988\u001b[0m     )\n\u001b[0;32m   1990\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m result\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\sqlalchemy\\engine\\base.py:2355\u001b[0m, in \u001b[0;36mConnection._handle_dbapi_exception\u001b[1;34m(self, e, statement, parameters, cursor, context, is_sub_exec)\u001b[0m\n\u001b[0;32m   2353\u001b[0m \u001b[38;5;28;01melif\u001b[39;00m should_wrap:\n\u001b[0;32m   2354\u001b[0m     \u001b[38;5;28;01massert\u001b[39;00m sqlalchemy_exception \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m\n\u001b[1;32m-> 2355\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m sqlalchemy_exception\u001b[38;5;241m.\u001b[39mwith_traceback(exc_info[\u001b[38;5;241m2\u001b[39m]) \u001b[38;5;28;01mfrom\u001b[39;00m \u001b[38;5;21;01me\u001b[39;00m\n\u001b[0;32m   2356\u001b[0m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[0;32m   2357\u001b[0m     \u001b[38;5;28;01massert\u001b[39;00m exc_info[\u001b[38;5;241m1\u001b[39m] \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\sqlalchemy\\engine\\base.py:1936\u001b[0m, in \u001b[0;36mConnection._exec_single_context\u001b[1;34m(self, dialect, context, statement, parameters)\u001b[0m\n\u001b[0;32m   1934\u001b[0m                 \u001b[38;5;28;01mbreak\u001b[39;00m\n\u001b[0;32m   1935\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m evt_handled:\n\u001b[1;32m-> 1936\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mdialect\u001b[38;5;241m.\u001b[39mdo_executemany(\n\u001b[0;32m   1937\u001b[0m             cursor,\n\u001b[0;32m   1938\u001b[0m             str_statement,\n\u001b[0;32m   1939\u001b[0m             effective_parameters,\n\u001b[0;32m   1940\u001b[0m             context,\n\u001b[0;32m   1941\u001b[0m         )\n\u001b[0;32m   1942\u001b[0m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m effective_parameters \u001b[38;5;129;01mand\u001b[39;00m context\u001b[38;5;241m.\u001b[39mno_parameters:\n\u001b[0;32m   1943\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mdialect\u001b[38;5;241m.\u001b[39m_has_events:\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\sqlalchemy\\dialects\\mysql\\mysqldb.py:170\u001b[0m, in \u001b[0;36mMySQLDialect_mysqldb.do_executemany\u001b[1;34m(self, cursor, statement, parameters, context)\u001b[0m\n\u001b[0;32m    169\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21mdo_executemany\u001b[39m(\u001b[38;5;28mself\u001b[39m, cursor, statement, parameters, context\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mNone\u001b[39;00m):\n\u001b[1;32m--> 170\u001b[0m     rowcount \u001b[38;5;241m=\u001b[39m cursor\u001b[38;5;241m.\u001b[39mexecutemany(statement, parameters)\n\u001b[0;32m    171\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m context \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[0;32m    172\u001b[0m         context\u001b[38;5;241m.\u001b[39m_rowcount \u001b[38;5;241m=\u001b[39m rowcount\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\cursors.py:182\u001b[0m, in \u001b[0;36mCursor.executemany\u001b[1;34m(self, query, args)\u001b[0m\n\u001b[0;32m    180\u001b[0m     q_postfix \u001b[38;5;241m=\u001b[39m m\u001b[38;5;241m.\u001b[39mgroup(\u001b[38;5;241m3\u001b[39m) \u001b[38;5;129;01mor\u001b[39;00m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[0;32m    181\u001b[0m     \u001b[38;5;28;01massert\u001b[39;00m q_values[\u001b[38;5;241m0\u001b[39m] \u001b[38;5;241m==\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m(\u001b[39m\u001b[38;5;124m\"\u001b[39m \u001b[38;5;129;01mand\u001b[39;00m q_values[\u001b[38;5;241m-\u001b[39m\u001b[38;5;241m1\u001b[39m] \u001b[38;5;241m==\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m)\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[1;32m--> 182\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_do_execute_many(\n\u001b[0;32m    183\u001b[0m         q_prefix,\n\u001b[0;32m    184\u001b[0m         q_values,\n\u001b[0;32m    185\u001b[0m         q_postfix,\n\u001b[0;32m    186\u001b[0m         args,\n\u001b[0;32m    187\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mmax_stmt_length,\n\u001b[0;32m    188\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_get_db()\u001b[38;5;241m.\u001b[39mencoding,\n\u001b[0;32m    189\u001b[0m     )\n\u001b[0;32m    191\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mrowcount \u001b[38;5;241m=\u001b[39m \u001b[38;5;28msum\u001b[39m(\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mexecute(query, arg) \u001b[38;5;28;01mfor\u001b[39;00m arg \u001b[38;5;129;01min\u001b[39;00m args)\n\u001b[0;32m    192\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mrowcount\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\cursors.py:220\u001b[0m, in \u001b[0;36mCursor._do_execute_many\u001b[1;34m(self, prefix, values, postfix, args, max_stmt_length, encoding)\u001b[0m\n\u001b[0;32m    218\u001b[0m         sql \u001b[38;5;241m+\u001b[39m\u001b[38;5;241m=\u001b[39m \u001b[38;5;124mb\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m,\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[0;32m    219\u001b[0m     sql \u001b[38;5;241m+\u001b[39m\u001b[38;5;241m=\u001b[39m v\n\u001b[1;32m--> 220\u001b[0m rows \u001b[38;5;241m+\u001b[39m\u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mexecute(sql \u001b[38;5;241m+\u001b[39m postfix)\n\u001b[0;32m    221\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mrowcount \u001b[38;5;241m=\u001b[39m rows\n\u001b[0;32m    222\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m rows\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\cursors.py:153\u001b[0m, in \u001b[0;36mCursor.execute\u001b[1;34m(self, query, args)\u001b[0m\n\u001b[0;32m    149\u001b[0m     \u001b[38;5;28;01mpass\u001b[39;00m\n\u001b[0;32m    151\u001b[0m query \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mmogrify(query, args)\n\u001b[1;32m--> 153\u001b[0m result \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_query(query)\n\u001b[0;32m    154\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_executed \u001b[38;5;241m=\u001b[39m query\n\u001b[0;32m    155\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m result\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\cursors.py:322\u001b[0m, in \u001b[0;36mCursor._query\u001b[1;34m(self, q)\u001b[0m\n\u001b[0;32m    320\u001b[0m conn \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_get_db()\n\u001b[0;32m    321\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_clear_result()\n\u001b[1;32m--> 322\u001b[0m conn\u001b[38;5;241m.\u001b[39mquery(q)\n\u001b[0;32m    323\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_do_get_result()\n\u001b[0;32m    324\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mrowcount\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\connections.py:563\u001b[0m, in \u001b[0;36mConnection.query\u001b[1;34m(self, sql, unbuffered)\u001b[0m\n\u001b[0;32m    561\u001b[0m     sql \u001b[38;5;241m=\u001b[39m sql\u001b[38;5;241m.\u001b[39mencode(\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mencoding, \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124msurrogateescape\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[0;32m    562\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_execute_command(COMMAND\u001b[38;5;241m.\u001b[39mCOM_QUERY, sql)\n\u001b[1;32m--> 563\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_affected_rows \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_read_query_result(unbuffered\u001b[38;5;241m=\u001b[39munbuffered)\n\u001b[0;32m    564\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_affected_rows\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\connections.py:825\u001b[0m, in \u001b[0;36mConnection._read_query_result\u001b[1;34m(self, unbuffered)\u001b[0m\n\u001b[0;32m    823\u001b[0m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[0;32m    824\u001b[0m     result \u001b[38;5;241m=\u001b[39m MySQLResult(\u001b[38;5;28mself\u001b[39m)\n\u001b[1;32m--> 825\u001b[0m     result\u001b[38;5;241m.\u001b[39mread()\n\u001b[0;32m    826\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_result \u001b[38;5;241m=\u001b[39m result\n\u001b[0;32m    827\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m result\u001b[38;5;241m.\u001b[39mserver_status \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\connections.py:1199\u001b[0m, in \u001b[0;36mMySQLResult.read\u001b[1;34m(self)\u001b[0m\n\u001b[0;32m   1197\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21mread\u001b[39m(\u001b[38;5;28mself\u001b[39m):\n\u001b[0;32m   1198\u001b[0m     \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[1;32m-> 1199\u001b[0m         first_packet \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mconnection\u001b[38;5;241m.\u001b[39m_read_packet()\n\u001b[0;32m   1201\u001b[0m         \u001b[38;5;28;01mif\u001b[39;00m first_packet\u001b[38;5;241m.\u001b[39mis_ok_packet():\n\u001b[0;32m   1202\u001b[0m             \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_read_ok_packet(first_packet)\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\connections.py:775\u001b[0m, in \u001b[0;36mConnection._read_packet\u001b[1;34m(self, packet_type)\u001b[0m\n\u001b[0;32m    773\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_result\u001b[38;5;241m.\u001b[39munbuffered_active \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;28;01mTrue\u001b[39;00m:\n\u001b[0;32m    774\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_result\u001b[38;5;241m.\u001b[39munbuffered_active \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;01mFalse\u001b[39;00m\n\u001b[1;32m--> 775\u001b[0m     packet\u001b[38;5;241m.\u001b[39mraise_for_error()\n\u001b[0;32m    776\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m packet\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\protocol.py:219\u001b[0m, in \u001b[0;36mMysqlPacket.raise_for_error\u001b[1;34m(self)\u001b[0m\n\u001b[0;32m    217\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m DEBUG:\n\u001b[0;32m    218\u001b[0m     \u001b[38;5;28mprint\u001b[39m(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124merrno =\u001b[39m\u001b[38;5;124m\"\u001b[39m, errno)\n\u001b[1;32m--> 219\u001b[0m err\u001b[38;5;241m.\u001b[39mraise_mysql_exception(\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_data)\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3\\Lib\\site-packages\\pymysql\\err.py:150\u001b[0m, in \u001b[0;36mraise_mysql_exception\u001b[1;34m(data)\u001b[0m\n\u001b[0;32m    148\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m errorclass \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[0;32m    149\u001b[0m     errorclass \u001b[38;5;241m=\u001b[39m InternalError \u001b[38;5;28;01mif\u001b[39;00m errno \u001b[38;5;241m<\u001b[39m \u001b[38;5;241m1000\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m OperationalError\n\u001b[1;32m--> 150\u001b[0m \u001b[38;5;28;01mraise\u001b[39;00m errorclass(errno, errval)\n",
      "\u001b[1;31mIntegrityError\u001b[0m: (pymysql.err.IntegrityError) (1062, \"Duplicate entry 'rahul.sharma@gmail.com' for key 'customers.email'\")\n[SQL: INSERT INTO customers (first_name, last_name, email, phone, city, registration_date) VALUES (%(first_name)s, %(last_name)s, %(email)s, %(phone)s, %(city)s, %(registration_date)s)]\n[parameters: [{'first_name': 'Rahul', 'last_name': 'Sharma', 'email': 'rahul.sharma@gmail.com', 'phone': '+91-9876543210', 'city': 'Bangalore', 'registration_date': datetime.date(2023, 1, 15)}, {'first_name': 'Priya', 'last_name': 'Patel', 'email': 'priya.patel@yahoo.com', 'phone': '+91-9988776655', 'city': 'Mumbai', 'registration_date': datetime.date(2023, 2, 20)}, {'first_name': 'Sneha', 'last_name': 'Reddy', 'email': 'sneha.reddy@gmail.com', 'phone': '+91-9123456789', 'city': 'Hyderabad', 'registration_date': datetime.date(2023, 4, 15)}, {'first_name': 'Vikram', 'last_name': 'Singh', 'email': 'vikram.singh@outlook.com', 'phone': '+91-9988112233', 'city': 'Chennai', 'registration_date': datetime.date(2023, 5, 22)}, {'first_name': 'Anjali', 'last_name': 'Mehta', 'email': 'anjali.mehta@gmail.com', 'phone': '+91-9876543210', 'city': 'Bangalore', 'registration_date': datetime.date(2023, 6, 18)}, {'first_name': 'Pooja', 'last_name': 'Iyer', 'email': 'pooja.iyer@gmail.com', 'phone': '+91-9123456780', 'city': 'Bangalore', 'registration_date': datetime.date(2023, 8, 15)}, {'first_name': 'Karthik', 'last_name': 'Nair', 'email': 'karthik.nair@yahoo.com', 'phone': '+91-9988776644', 'city': 'Kochi', 'registration_date': datetime.date(2023, 9, 30)}, {'first_name': 'Deepa', 'last_name': 'Gupta', 'email': 'deepa.gupta@gmail.com', 'phone': '+91-9871234567', 'city': 'Delhi', 'registration_date': datetime.date(2023, 10, 12)}  ... displaying 10 of 20 total bound parameter sets ...  {'first_name': 'Meera', 'last_name': 'Nambiar', 'email': 'meera.nambiar@gmail.com', 'phone': '+91-9123456723', 'city': 'Trivandrum', 'registration_date': datetime.date(2024, 3, 25)}, {'first_name': 'Sanjay', 'last_name': 'Agarwal', 'email': 'sanjay.agarwal@gmail.com', 'phone': '+91-9876543276', 'city': 'Lucknow', 'registration_date': datetime.date(2024, 3, 28)}]]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"
     ]
    }
   ],
   "source": [
    "# Loading Customer table\n",
    "customers_df[[\n",
    "    \"first_name\", \"last_name\", \"email\",\n",
    "    \"phone\", \"city\", \"registration_date\"\n",
    "]].to_sql(\n",
    "    \"customers\",\n",
    "    con=engine,\n",
    "    if_exists=\"append\",\n",
    "    index=False\n",
    ")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 135,
   "id": "c588f6bd-65d0-451d-891d-ee9882e39c20",
   "metadata": {},
   "outputs": [],
   "source": [
    "#please disregard the above error, since the file is already uploaded. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "a073c323-92f2-4175-b255-26bd8480e450",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "20"
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Loading Products table\n",
    "products_df[[\n",
    "    \"product_name\", \"category\", \"price\", \"stock_quantity\"\n",
    "]].to_sql(\n",
    "    \"products\",\n",
    "    con=engine,\n",
    "    if_exists=\"append\",\n",
    "    index=False\n",
    ")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "0e45a98b-78f5-4098-bf74-a765804c2572",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Creating Lookup Dictionaries to map source system natural keys to database-generated surrogate keys so that foreign key relationships can be correctly established during data loading.\n",
    "\n",
    "customers_db = pd.read_sql(\"SELECT customer_id, email FROM customers\", engine)\n",
    "products_db  = pd.read_sql(\"SELECT product_id, product_name FROM products\", engine)\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "82945a44-8443-4139-aaca-933699cbc18f",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Buidling and loading Orders table\n",
    "# Order granularity : One order per transaction\n",
    "# One Aggregate column \"total_amount\" = quantity × unit_price\n",
    "\n",
    "orders_df = sales_df.copy()\n",
    "orders_df[\"total_amount\"] = orders_df[\"quantity\"] * orders_df[\"unit_price\"]\n",
    "\n",
    "orders_df = orders_df.merge(\n",
    "    customers_db, left_on=\"customer_id\", right_on=\"email\", how=\"left\"\n",
    ")\n",
    "\n",
    "orders_df = orders_df[[\n",
    "    \"customer_id_y\", \"transaction_date\", \"total_amount\", \"status\"\n",
    "]]\n",
    "\n",
    "orders_df.columns = [\"customer_id\", \"order_date\", \"total_amount\", \"status\"]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 38,
   "id": "0ee3f427-97aa-4366-a4da-0d359ff1d561",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Index(['transaction_id', 'customer_id', 'product_id', 'quantity', 'unit_price',\n",
      "       'transaction_date', 'status'],\n",
      "      dtype='object')\n"
     ]
    }
   ],
   "source": [
    "#getting error when trying to load orders table due to missing email column to merge on in sales table\n",
    "print(sales_df.columns)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "e57d1715-6c21-42af-99ae-46dadf71eed2",
   "metadata": {},
   "outputs": [],
   "source": [
    "sales_enriched_df = sales_df.merge(\n",
    "    customers_df[[\"customer_id\", \"email\"]],\n",
    "    on=\"customer_id\",\n",
    "    how=\"left\"\n",
    ")  #adding email column to sales files"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "92d4441b-edf4-410c-bc69-7bc2e2a7468d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>customer_id</th>\n",
       "      <th>email</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>C001</td>\n",
       "      <td>rahul.sharma@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>C002</td>\n",
       "      <td>priya.patel@yahoo.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>C003</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>C005</td>\n",
       "      <td>vikram.singh@outlook.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>C006</td>\n",
       "      <td>anjali.mehta@gmail.com</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  customer_id                     email\n",
       "0        C001    rahul.sharma@gmail.com\n",
       "1        C002     priya.patel@yahoo.com\n",
       "2        C003                       NaN\n",
       "3        C005  vikram.singh@outlook.com\n",
       "4        C006    anjali.mehta@gmail.com"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sales_enriched_df[[\"customer_id\", \"email\"]].head()  #checking if email column was successfully added. \n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "b85b0356-a0e7-4851-829d-aaa7f5ce8e78",
   "metadata": {},
   "outputs": [],
   "source": [
    "customers_lookup = pd.read_sql(\n",
    "    \"SELECT customer_id, email FROM customers\",\n",
    "    engine\n",
    ")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "1bad2bb4-c11c-4c97-8dd9-330e1323b2e2",
   "metadata": {},
   "outputs": [],
   "source": [
    "customers_lookup.rename(\n",
    "    columns={\"customer_id\": \"customer_sk\"},\n",
    "    inplace=True\n",
    ") \n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "245f043c-9244-41f7-b76f-9ad02c4d5ac8",
   "metadata": {},
   "outputs": [],
   "source": [
    "orders_df = sales_enriched_df.merge(\n",
    "    customers_lookup,\n",
    "    on=\"email\",\n",
    "    how=\"left\"\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "bb397c3e-0686-4fc0-b24d-5053d0cd9b43",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>transaction_id</th>\n",
       "      <th>customer_id</th>\n",
       "      <th>product_id</th>\n",
       "      <th>quantity</th>\n",
       "      <th>unit_price</th>\n",
       "      <th>transaction_date</th>\n",
       "      <th>status</th>\n",
       "      <th>email</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>T001</td>\n",
       "      <td>C001</td>\n",
       "      <td>P001</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>2024-01-15</td>\n",
       "      <td>Completed</td>\n",
       "      <td>rahul.sharma@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>T002</td>\n",
       "      <td>C002</td>\n",
       "      <td>P004</td>\n",
       "      <td>2</td>\n",
       "      <td>2999.0</td>\n",
       "      <td>2024-01-16</td>\n",
       "      <td>Completed</td>\n",
       "      <td>priya.patel@yahoo.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>T003</td>\n",
       "      <td>C003</td>\n",
       "      <td>P007</td>\n",
       "      <td>1</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>2024-01-15</td>\n",
       "      <td>Completed</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>T005</td>\n",
       "      <td>C005</td>\n",
       "      <td>P009</td>\n",
       "      <td>3</td>\n",
       "      <td>650.0</td>\n",
       "      <td>2024-01-20</td>\n",
       "      <td>Completed</td>\n",
       "      <td>vikram.singh@outlook.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>T006</td>\n",
       "      <td>C006</td>\n",
       "      <td>P012</td>\n",
       "      <td>1</td>\n",
       "      <td>12999.0</td>\n",
       "      <td>2024-01-22</td>\n",
       "      <td>Completed</td>\n",
       "      <td>anjali.mehta@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>T007</td>\n",
       "      <td>C007</td>\n",
       "      <td>P005</td>\n",
       "      <td>2</td>\n",
       "      <td>1999.0</td>\n",
       "      <td>2024-01-23</td>\n",
       "      <td>Completed</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>T009</td>\n",
       "      <td>C009</td>\n",
       "      <td>P011</td>\n",
       "      <td>1</td>\n",
       "      <td>4599.0</td>\n",
       "      <td>2024-01-28</td>\n",
       "      <td>Cancelled</td>\n",
       "      <td>karthik.nair@yahoo.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>T010</td>\n",
       "      <td>C010</td>\n",
       "      <td>P006</td>\n",
       "      <td>5</td>\n",
       "      <td>899.0</td>\n",
       "      <td>2024-02-01</td>\n",
       "      <td>Completed</td>\n",
       "      <td>deepa.gupta@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>T011</td>\n",
       "      <td>C011</td>\n",
       "      <td>P014</td>\n",
       "      <td>1</td>\n",
       "      <td>69999.0</td>\n",
       "      <td>2024-02-02</td>\n",
       "      <td>Completed</td>\n",
       "      <td>arjun.rao@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>T012</td>\n",
       "      <td>C012</td>\n",
       "      <td>P003</td>\n",
       "      <td>1</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>2024-02-05</td>\n",
       "      <td>Completed</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>T013</td>\n",
       "      <td>C013</td>\n",
       "      <td>P015</td>\n",
       "      <td>3</td>\n",
       "      <td>450.0</td>\n",
       "      <td>2024-02-08</td>\n",
       "      <td>Completed</td>\n",
       "      <td>suresh.patel@outlook.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>T014</td>\n",
       "      <td>C014</td>\n",
       "      <td>P019</td>\n",
       "      <td>2</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>2024-10-02</td>\n",
       "      <td>Completed</td>\n",
       "      <td>neha.shah@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>T015</td>\n",
       "      <td>C015</td>\n",
       "      <td>P008</td>\n",
       "      <td>3</td>\n",
       "      <td>1299.0</td>\n",
       "      <td>2024-02-12</td>\n",
       "      <td>Completed</td>\n",
       "      <td>manish.joshi@yahoo.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>T017</td>\n",
       "      <td>C017</td>\n",
       "      <td>P016</td>\n",
       "      <td>1</td>\n",
       "      <td>32999.0</td>\n",
       "      <td>2024-02-18</td>\n",
       "      <td>Completed</td>\n",
       "      <td>rajesh.kumar@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>T018</td>\n",
       "      <td>C018</td>\n",
       "      <td>P020</td>\n",
       "      <td>2</td>\n",
       "      <td>1899.0</td>\n",
       "      <td>2024-02-20</td>\n",
       "      <td>Completed</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>T019</td>\n",
       "      <td>C019</td>\n",
       "      <td>P018</td>\n",
       "      <td>10</td>\n",
       "      <td>120.0</td>\n",
       "      <td>2024-02-22</td>\n",
       "      <td>Completed</td>\n",
       "      <td>arun.pillai@outlook.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>T020</td>\n",
       "      <td>C020</td>\n",
       "      <td>P010</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>2024-02-25</td>\n",
       "      <td>Completed</td>\n",
       "      <td>swati.desai@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>T021</td>\n",
       "      <td>C021</td>\n",
       "      <td>P017</td>\n",
       "      <td>2</td>\n",
       "      <td>2999.0</td>\n",
       "      <td>2024-02-28</td>\n",
       "      <td>Completed</td>\n",
       "      <td>nikhil.bose@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>T022</td>\n",
       "      <td>C002</td>\n",
       "      <td>P001</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>2024-03-01</td>\n",
       "      <td>Completed</td>\n",
       "      <td>priya.patel@yahoo.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>T023</td>\n",
       "      <td>C003</td>\n",
       "      <td>P019</td>\n",
       "      <td>3</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>2024-02-03</td>\n",
       "      <td>Completed</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>T024</td>\n",
       "      <td>C004</td>\n",
       "      <td>P009</td>\n",
       "      <td>5</td>\n",
       "      <td>650.0</td>\n",
       "      <td>2024-03-05</td>\n",
       "      <td>Completed</td>\n",
       "      <td>sneha.reddy@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>T026</td>\n",
       "      <td>C006</td>\n",
       "      <td>P011</td>\n",
       "      <td>1</td>\n",
       "      <td>4599.0</td>\n",
       "      <td>2024-03-10</td>\n",
       "      <td>Completed</td>\n",
       "      <td>anjali.mehta@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>T027</td>\n",
       "      <td>C007</td>\n",
       "      <td>P002</td>\n",
       "      <td>2</td>\n",
       "      <td>3499.0</td>\n",
       "      <td>2024-12-03</td>\n",
       "      <td>Completed</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>T028</td>\n",
       "      <td>C008</td>\n",
       "      <td>P015</td>\n",
       "      <td>4</td>\n",
       "      <td>450.0</td>\n",
       "      <td>2024-03-15</td>\n",
       "      <td>Completed</td>\n",
       "      <td>pooja.iyer@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>T029</td>\n",
       "      <td>C009</td>\n",
       "      <td>P007</td>\n",
       "      <td>1</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>2024-03-18</td>\n",
       "      <td>Completed</td>\n",
       "      <td>karthik.nair@yahoo.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>T031</td>\n",
       "      <td>C011</td>\n",
       "      <td>P012</td>\n",
       "      <td>1</td>\n",
       "      <td>12999.0</td>\n",
       "      <td>2024-03-22</td>\n",
       "      <td>Completed</td>\n",
       "      <td>arjun.rao@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>T032</td>\n",
       "      <td>C012</td>\n",
       "      <td>P016</td>\n",
       "      <td>1</td>\n",
       "      <td>32999.0</td>\n",
       "      <td>2024-03-25</td>\n",
       "      <td>Completed</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>T033</td>\n",
       "      <td>C013</td>\n",
       "      <td>P005</td>\n",
       "      <td>2</td>\n",
       "      <td>1999.0</td>\n",
       "      <td>2024-03-28</td>\n",
       "      <td>Completed</td>\n",
       "      <td>suresh.patel@outlook.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>T034</td>\n",
       "      <td>C014</td>\n",
       "      <td>P008</td>\n",
       "      <td>2</td>\n",
       "      <td>1299.0</td>\n",
       "      <td>2024-03-30</td>\n",
       "      <td>Completed</td>\n",
       "      <td>neha.shah@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>T035</td>\n",
       "      <td>C015</td>\n",
       "      <td>P018</td>\n",
       "      <td>8</td>\n",
       "      <td>120.0</td>\n",
       "      <td>2024-01-04</td>\n",
       "      <td>Completed</td>\n",
       "      <td>manish.joshi@yahoo.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>T036</td>\n",
       "      <td>C016</td>\n",
       "      <td>P014</td>\n",
       "      <td>1</td>\n",
       "      <td>69999.0</td>\n",
       "      <td>2024-04-03</td>\n",
       "      <td>Completed</td>\n",
       "      <td>divya.menon@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>T037</td>\n",
       "      <td>C017</td>\n",
       "      <td>P006</td>\n",
       "      <td>4</td>\n",
       "      <td>899.0</td>\n",
       "      <td>2024-04-05</td>\n",
       "      <td>Completed</td>\n",
       "      <td>rajesh.kumar@gmail.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>T038</td>\n",
       "      <td>C018</td>\n",
       "      <td>P020</td>\n",
       "      <td>1</td>\n",
       "      <td>1899.0</td>\n",
       "      <td>2024-08-04</td>\n",
       "      <td>Completed</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>T039</td>\n",
       "      <td>C019</td>\n",
       "      <td>P019</td>\n",
       "      <td>2</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>2024-04-10</td>\n",
       "      <td>Completed</td>\n",
       "      <td>arun.pillai@outlook.com</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>T040</td>\n",
       "      <td>C020</td>\n",
       "      <td>P013</td>\n",
       "      <td>1</td>\n",
       "      <td>5499.0</td>\n",
       "      <td>2024-04-12</td>\n",
       "      <td>Completed</td>\n",
       "      <td>swati.desai@gmail.com</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   transaction_id customer_id product_id  quantity  unit_price  \\\n",
       "0            T001        C001       P001         1     45999.0   \n",
       "1            T002        C002       P004         2      2999.0   \n",
       "2            T003        C003       P007         1     52999.0   \n",
       "3            T005        C005       P009         3       650.0   \n",
       "4            T006        C006       P012         1     12999.0   \n",
       "5            T007        C007       P005         2      1999.0   \n",
       "6            T009        C009       P011         1      4599.0   \n",
       "7            T010        C010       P006         5       899.0   \n",
       "8            T011        C011       P014         1     69999.0   \n",
       "9            T012        C012       P003         1     52999.0   \n",
       "10           T013        C013       P015         3       450.0   \n",
       "11           T014        C014       P019         2      1499.0   \n",
       "12           T015        C015       P008         3      1299.0   \n",
       "13           T017        C017       P016         1     32999.0   \n",
       "14           T018        C018       P020         2      1899.0   \n",
       "15           T019        C019       P018        10       120.0   \n",
       "16           T020        C020       P010         1     45999.0   \n",
       "17           T021        C021       P017         2      2999.0   \n",
       "18           T022        C002       P001         1     45999.0   \n",
       "19           T023        C003       P019         3      1499.0   \n",
       "20           T024        C004       P009         5       650.0   \n",
       "21           T026        C006       P011         1      4599.0   \n",
       "22           T027        C007       P002         2      3499.0   \n",
       "23           T028        C008       P015         4       450.0   \n",
       "24           T029        C009       P007         1     52999.0   \n",
       "25           T031        C011       P012         1     12999.0   \n",
       "26           T032        C012       P016         1     32999.0   \n",
       "27           T033        C013       P005         2      1999.0   \n",
       "28           T034        C014       P008         2      1299.0   \n",
       "29           T035        C015       P018         8       120.0   \n",
       "30           T036        C016       P014         1     69999.0   \n",
       "31           T037        C017       P006         4       899.0   \n",
       "32           T038        C018       P020         1      1899.0   \n",
       "33           T039        C019       P019         2      1499.0   \n",
       "34           T040        C020       P013         1      5499.0   \n",
       "\n",
       "   transaction_date     status                     email  \n",
       "0        2024-01-15  Completed    rahul.sharma@gmail.com  \n",
       "1        2024-01-16  Completed     priya.patel@yahoo.com  \n",
       "2        2024-01-15  Completed                       NaN  \n",
       "3        2024-01-20  Completed  vikram.singh@outlook.com  \n",
       "4        2024-01-22  Completed    anjali.mehta@gmail.com  \n",
       "5        2024-01-23  Completed                       NaN  \n",
       "6        2024-01-28  Cancelled    karthik.nair@yahoo.com  \n",
       "7        2024-02-01  Completed     deepa.gupta@gmail.com  \n",
       "8        2024-02-02  Completed       arjun.rao@gmail.com  \n",
       "9        2024-02-05  Completed                       NaN  \n",
       "10       2024-02-08  Completed  suresh.patel@outlook.com  \n",
       "11       2024-10-02  Completed       neha.shah@gmail.com  \n",
       "12       2024-02-12  Completed    manish.joshi@yahoo.com  \n",
       "13       2024-02-18  Completed    rajesh.kumar@gmail.com  \n",
       "14       2024-02-20  Completed                       NaN  \n",
       "15       2024-02-22  Completed   arun.pillai@outlook.com  \n",
       "16       2024-02-25  Completed     swati.desai@gmail.com  \n",
       "17       2024-02-28  Completed     nikhil.bose@gmail.com  \n",
       "18       2024-03-01  Completed     priya.patel@yahoo.com  \n",
       "19       2024-02-03  Completed                       NaN  \n",
       "20       2024-03-05  Completed     sneha.reddy@gmail.com  \n",
       "21       2024-03-10  Completed    anjali.mehta@gmail.com  \n",
       "22       2024-12-03  Completed                       NaN  \n",
       "23       2024-03-15  Completed      pooja.iyer@gmail.com  \n",
       "24       2024-03-18  Completed    karthik.nair@yahoo.com  \n",
       "25       2024-03-22  Completed       arjun.rao@gmail.com  \n",
       "26       2024-03-25  Completed                       NaN  \n",
       "27       2024-03-28  Completed  suresh.patel@outlook.com  \n",
       "28       2024-03-30  Completed       neha.shah@gmail.com  \n",
       "29       2024-01-04  Completed    manish.joshi@yahoo.com  \n",
       "30       2024-04-03  Completed     divya.menon@gmail.com  \n",
       "31       2024-04-05  Completed    rajesh.kumar@gmail.com  \n",
       "32       2024-08-04  Completed                       NaN  \n",
       "33       2024-04-10  Completed   arun.pillai@outlook.com  \n",
       "34       2024-04-12  Completed     swati.desai@gmail.com  "
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sales_enriched_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "id": "237c11e2-232b-4fb3-a292-e5229cb61452",
   "metadata": {},
   "outputs": [],
   "source": [
    "orders_df = orders_df.dropna(subset=[\"customer_sk\"])  # Dropping Unmappable Row\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 100,
   "id": "bf8ac8bd-5d25-4c00-a070-ecc043716869",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>transaction_id</th>\n",
       "      <th>customer_id</th>\n",
       "      <th>order_date</th>\n",
       "      <th>status</th>\n",
       "      <th>total_amount</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>T001</td>\n",
       "      <td>1.0</td>\n",
       "      <td>2024-01-15</td>\n",
       "      <td>Completed</td>\n",
       "      <td>45999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>T002</td>\n",
       "      <td>2.0</td>\n",
       "      <td>2024-01-16</td>\n",
       "      <td>Completed</td>\n",
       "      <td>5998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>T005</td>\n",
       "      <td>4.0</td>\n",
       "      <td>2024-01-20</td>\n",
       "      <td>Completed</td>\n",
       "      <td>1950.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>T006</td>\n",
       "      <td>5.0</td>\n",
       "      <td>2024-01-22</td>\n",
       "      <td>Completed</td>\n",
       "      <td>12999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>T009</td>\n",
       "      <td>7.0</td>\n",
       "      <td>2024-01-28</td>\n",
       "      <td>Cancelled</td>\n",
       "      <td>4599.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>T010</td>\n",
       "      <td>8.0</td>\n",
       "      <td>2024-02-01</td>\n",
       "      <td>Completed</td>\n",
       "      <td>4495.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>T011</td>\n",
       "      <td>9.0</td>\n",
       "      <td>2024-02-02</td>\n",
       "      <td>Completed</td>\n",
       "      <td>69999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>T013</td>\n",
       "      <td>10.0</td>\n",
       "      <td>2024-02-08</td>\n",
       "      <td>Completed</td>\n",
       "      <td>1350.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>T014</td>\n",
       "      <td>11.0</td>\n",
       "      <td>2024-10-02</td>\n",
       "      <td>Completed</td>\n",
       "      <td>2998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>T015</td>\n",
       "      <td>12.0</td>\n",
       "      <td>2024-02-12</td>\n",
       "      <td>Completed</td>\n",
       "      <td>3897.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>T017</td>\n",
       "      <td>14.0</td>\n",
       "      <td>2024-02-18</td>\n",
       "      <td>Completed</td>\n",
       "      <td>32999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>T019</td>\n",
       "      <td>15.0</td>\n",
       "      <td>2024-02-22</td>\n",
       "      <td>Completed</td>\n",
       "      <td>1200.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>T020</td>\n",
       "      <td>16.0</td>\n",
       "      <td>2024-02-25</td>\n",
       "      <td>Completed</td>\n",
       "      <td>45999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>T021</td>\n",
       "      <td>17.0</td>\n",
       "      <td>2024-02-28</td>\n",
       "      <td>Completed</td>\n",
       "      <td>5998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>T022</td>\n",
       "      <td>2.0</td>\n",
       "      <td>2024-03-01</td>\n",
       "      <td>Completed</td>\n",
       "      <td>45999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>T024</td>\n",
       "      <td>3.0</td>\n",
       "      <td>2024-03-05</td>\n",
       "      <td>Completed</td>\n",
       "      <td>3250.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>T026</td>\n",
       "      <td>5.0</td>\n",
       "      <td>2024-03-10</td>\n",
       "      <td>Completed</td>\n",
       "      <td>4599.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>T028</td>\n",
       "      <td>6.0</td>\n",
       "      <td>2024-03-15</td>\n",
       "      <td>Completed</td>\n",
       "      <td>1800.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>T029</td>\n",
       "      <td>7.0</td>\n",
       "      <td>2024-03-18</td>\n",
       "      <td>Completed</td>\n",
       "      <td>52999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>T031</td>\n",
       "      <td>9.0</td>\n",
       "      <td>2024-03-22</td>\n",
       "      <td>Completed</td>\n",
       "      <td>12999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>T033</td>\n",
       "      <td>10.0</td>\n",
       "      <td>2024-03-28</td>\n",
       "      <td>Completed</td>\n",
       "      <td>3998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>T034</td>\n",
       "      <td>11.0</td>\n",
       "      <td>2024-03-30</td>\n",
       "      <td>Completed</td>\n",
       "      <td>2598.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>T035</td>\n",
       "      <td>12.0</td>\n",
       "      <td>2024-01-04</td>\n",
       "      <td>Completed</td>\n",
       "      <td>960.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>T036</td>\n",
       "      <td>13.0</td>\n",
       "      <td>2024-04-03</td>\n",
       "      <td>Completed</td>\n",
       "      <td>69999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>T037</td>\n",
       "      <td>14.0</td>\n",
       "      <td>2024-04-05</td>\n",
       "      <td>Completed</td>\n",
       "      <td>3596.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>T039</td>\n",
       "      <td>15.0</td>\n",
       "      <td>2024-04-10</td>\n",
       "      <td>Completed</td>\n",
       "      <td>2998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>T040</td>\n",
       "      <td>16.0</td>\n",
       "      <td>2024-04-12</td>\n",
       "      <td>Completed</td>\n",
       "      <td>5499.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   transaction_id  customer_id  order_date     status  total_amount\n",
       "0            T001          1.0  2024-01-15  Completed       45999.0\n",
       "1            T002          2.0  2024-01-16  Completed        5998.0\n",
       "2            T005          4.0  2024-01-20  Completed        1950.0\n",
       "3            T006          5.0  2024-01-22  Completed       12999.0\n",
       "4            T009          7.0  2024-01-28  Cancelled        4599.0\n",
       "5            T010          8.0  2024-02-01  Completed        4495.0\n",
       "6            T011          9.0  2024-02-02  Completed       69999.0\n",
       "7            T013         10.0  2024-02-08  Completed        1350.0\n",
       "8            T014         11.0  2024-10-02  Completed        2998.0\n",
       "9            T015         12.0  2024-02-12  Completed        3897.0\n",
       "10           T017         14.0  2024-02-18  Completed       32999.0\n",
       "11           T019         15.0  2024-02-22  Completed        1200.0\n",
       "12           T020         16.0  2024-02-25  Completed       45999.0\n",
       "13           T021         17.0  2024-02-28  Completed        5998.0\n",
       "14           T022          2.0  2024-03-01  Completed       45999.0\n",
       "15           T024          3.0  2024-03-05  Completed        3250.0\n",
       "16           T026          5.0  2024-03-10  Completed        4599.0\n",
       "17           T028          6.0  2024-03-15  Completed        1800.0\n",
       "18           T029          7.0  2024-03-18  Completed       52999.0\n",
       "19           T031          9.0  2024-03-22  Completed       12999.0\n",
       "20           T033         10.0  2024-03-28  Completed        3998.0\n",
       "21           T034         11.0  2024-03-30  Completed        2598.0\n",
       "22           T035         12.0  2024-01-04  Completed         960.0\n",
       "23           T036         13.0  2024-04-03  Completed       69999.0\n",
       "24           T037         14.0  2024-04-05  Completed        3596.0\n",
       "25           T039         15.0  2024-04-10  Completed        2998.0\n",
       "26           T040         16.0  2024-04-12  Completed        5499.0"
      ]
     },
     "execution_count": 100,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "orders_agg_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "42aef793-b464-4d13-ac4a-6e24dc0c2c26",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Index(['transaction_id', 'customer_id', 'order_date', 'status',\n",
      "       'total_amount'],\n",
      "      dtype='object')\n"
     ]
    }
   ],
   "source": [
    "print(orders_agg_df.columns)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "7ca75319-1c79-4474-b13f-155c799cf6cc",
   "metadata": {},
   "outputs": [],
   "source": [
    "orders_df[\"line_amount\"] = orders_df[\"unit_price\"] * orders_df[\"quantity\"]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "236b66bf-022d-49b1-bac3-5b158ddcb7e7",
   "metadata": {},
   "outputs": [],
   "source": [
    "orders_agg_df = (\n",
    "    orders_df\n",
    "    .groupby(\n",
    "        [\"transaction_id\", \"customer_sk\", \"transaction_date\", \"status\"],\n",
    "        as_index=False\n",
    "    )\n",
    "    .agg({\n",
    "        \"line_amount\": \"sum\"\n",
    "    })\n",
    ")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "fd82f1a1-46a6-4358-a588-8f260522a12a",
   "metadata": {},
   "outputs": [],
   "source": [
    "orders_agg_df.rename(columns={\n",
    "    \"customer_sk\": \"customer_id\",\n",
    "    \"transaction_date\": \"order_date\",\n",
    "    \"line_amount\": \"total_amount\"\n",
    "}, inplace=True)  #changing column names to match orders table schema\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "id": "2fbb6042-db12-42e3-9bd1-3aa43b498f4a",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>transaction_id</th>\n",
       "      <th>customer_id</th>\n",
       "      <th>order_date</th>\n",
       "      <th>status</th>\n",
       "      <th>total_amount</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>T001</td>\n",
       "      <td>1.0</td>\n",
       "      <td>2024-01-15</td>\n",
       "      <td>Completed</td>\n",
       "      <td>45999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>T002</td>\n",
       "      <td>2.0</td>\n",
       "      <td>2024-01-16</td>\n",
       "      <td>Completed</td>\n",
       "      <td>5998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>T005</td>\n",
       "      <td>4.0</td>\n",
       "      <td>2024-01-20</td>\n",
       "      <td>Completed</td>\n",
       "      <td>1950.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>T006</td>\n",
       "      <td>5.0</td>\n",
       "      <td>2024-01-22</td>\n",
       "      <td>Completed</td>\n",
       "      <td>12999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>T009</td>\n",
       "      <td>7.0</td>\n",
       "      <td>2024-01-28</td>\n",
       "      <td>Cancelled</td>\n",
       "      <td>4599.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  transaction_id  customer_id  order_date     status  total_amount\n",
       "0           T001          1.0  2024-01-15  Completed       45999.0\n",
       "1           T002          2.0  2024-01-16  Completed        5998.0\n",
       "2           T005          4.0  2024-01-20  Completed        1950.0\n",
       "3           T006          5.0  2024-01-22  Completed       12999.0\n",
       "4           T009          7.0  2024-01-28  Cancelled        4599.0"
      ]
     },
     "execution_count": 34,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "orders_agg_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "a7b9511a-bada-4cb3-9d77-436fc1b8b7d4",
   "metadata": {},
   "outputs": [],
   "source": [
    "orders_final_df = orders_agg_df[[\n",
    "    \"customer_id\",\n",
    "    \"order_date\",\n",
    "    \"total_amount\",\n",
    "    \"status\"\n",
    "]]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "id": "06ea08ce-46f3-4eb7-ac03-c0be2f9d36c0",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "27"
      ]
     },
     "execution_count": 53,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "orders_final_df.to_sql(\n",
    "    \"orders\",\n",
    "    engine,\n",
    "    if_exists=\"append\",\n",
    "    index=False\n",
    ")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "id": "1164d48d-f2b8-48dc-862c-2fa679fb5416",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>customer_id</th>\n",
       "      <th>order_date</th>\n",
       "      <th>total_amount</th>\n",
       "      <th>status</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1.0</td>\n",
       "      <td>2024-01-15</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2.0</td>\n",
       "      <td>2024-01-16</td>\n",
       "      <td>5998.0</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>4.0</td>\n",
       "      <td>2024-01-20</td>\n",
       "      <td>1950.0</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>5.0</td>\n",
       "      <td>2024-01-22</td>\n",
       "      <td>12999.0</td>\n",
       "      <td>Completed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>7.0</td>\n",
       "      <td>2024-01-28</td>\n",
       "      <td>4599.0</td>\n",
       "      <td>Cancelled</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   customer_id  order_date  total_amount     status\n",
       "0          1.0  2024-01-15       45999.0  Completed\n",
       "1          2.0  2024-01-16        5998.0  Completed\n",
       "2          4.0  2024-01-20        1950.0  Completed\n",
       "3          5.0  2024-01-22       12999.0  Completed\n",
       "4          7.0  2024-01-28        4599.0  Cancelled"
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "orders_final_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f4a860c1-1194-4643-8e43-3f7b8f18efae",
   "metadata": {},
   "outputs": [],
   "source": [
    "#----------------------------------------------------------------------------------- "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8503c39d-4517-4b09-95fd-b56083d4e1ba",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Creating Order_items table correctly as per schema"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 76,
   "id": "b8cc9a38-3a09-4caa-b5f9-a9b4e73193c0",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Reading sales file. \n",
    "\n",
    "order_items1_df = sales_enriched_df[['transaction_id', 'product_id', 'quantity', 'unit_price']].copy()\n",
    "\n",
    "\n",
    "#renaming to the correct column name\n",
    "order_items1_df.rename(columns={\"transaction_id\": \"order_id\"}, inplace=True)\n",
    "\n",
    "# Extracting numberic info from order_id and product_id\n",
    "order_items1_df[\"order_id\"] = (\n",
    "    order_items1_df[\"order_id\"]\n",
    "    .str.extract(r\"(\\d+)\")\n",
    "    .astype(int)\n",
    ")\n",
    "\n",
    "\n",
    "order_items1_df[\"product_id\"] = (\n",
    "    order_items1_df[\"product_id\"]\n",
    "    .str.extract(r\"(\\d+)\")\n",
    "    .astype(int)\n",
    ")\n",
    "\n",
    "#Calculate subtotal\n",
    "order_items1_df['subtotal'] = (\n",
    "    order_items_df['quantity'] * order_items_df['unit_price']\n",
    ").round(2)\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 78,
   "id": "d378340d-ffbc-4700-9608-6b271ffb34fa",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>order_id</th>\n",
       "      <th>product_id</th>\n",
       "      <th>quantity</th>\n",
       "      <th>unit_price</th>\n",
       "      <th>subtotal</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>5</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>650.0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>10</td>\n",
       "      <td>6</td>\n",
       "      <td>5</td>\n",
       "      <td>899.0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>13</td>\n",
       "      <td>15</td>\n",
       "      <td>3</td>\n",
       "      <td>450.0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>20</td>\n",
       "      <td>10</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>31</td>\n",
       "      <td>12</td>\n",
       "      <td>1</td>\n",
       "      <td>12999.0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>36</td>\n",
       "      <td>14</td>\n",
       "      <td>1</td>\n",
       "      <td>69999.0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    order_id  product_id  quantity  unit_price  subtotal\n",
       "3          5           9         3       650.0       NaN\n",
       "7         10           6         5       899.0       NaN\n",
       "10        13          15         3       450.0       NaN\n",
       "16        20          10         1     45999.0       NaN\n",
       "25        31          12         1     12999.0       NaN\n",
       "30        36          14         1     69999.0       NaN"
      ]
     },
     "execution_count": 78,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Checking if subtotal is not null \n",
    "order_items1_df[\n",
    "    order_items1_df['subtotal'].isna()\n",
    "]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 79,
   "id": "e876c0de-a018-4920-9545-4985721b8097",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>product_id</th>\n",
       "      <th>quantity</th>\n",
       "      <th>unit_price</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "Empty DataFrame\n",
       "Columns: [product_id, quantity, unit_price]\n",
       "Index: []"
      ]
     },
     "execution_count": 79,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Seeing few columns with NaN as subtotal, hence chekcing which feild is not being properly used for multiplication. \n",
    "\n",
    "order_items1_df[\n",
    "    order_items1_df['quantity'].isna() |\n",
    "    order_items1_df['unit_price'].isna()\n",
    "][['product_id', 'quantity', 'unit_price']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 80,
   "id": "b3a5c6f7-ff52-4a59-b5fa-b613639e6087",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "quantity        int64\n",
       "unit_price    float64\n",
       "subtotal      float64\n",
       "dtype: object"
      ]
     },
     "execution_count": 80,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Checking data types to identify error\n",
    "order_items1_df[['quantity', 'unit_price', 'subtotal']].dtypes\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "id": "7ba3a7de-61d0-4b17-8cd6-2f5733cc391e",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0    45999.0\n",
       "1     5998.0\n",
       "2    52999.0\n",
       "4     1950.0\n",
       "5    12999.0\n",
       "dtype: float64"
      ]
     },
     "execution_count": 65,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Checking output for multiplication\n",
    "(order_items_df['quantity'] * order_items_df['unit_price']).head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 88,
   "id": "13a23518-e86a-4d78-b784-201075d99378",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Delete the existing broken column\n",
    "if 'subtotal' in order_items1_df.columns:\n",
    "    order_items1_df.drop(columns=['subtotal'], inplace=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 89,
   "id": "f019ca3b-db0c-4a7c-8915-b935f6ebafe5",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Recalculate after all merges & type fixes\n",
    "order_items1_df['subtotal'] = (\n",
    "    order_items1_df['quantity'] * order_items1_df['unit_price']\n",
    ").round(2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 109,
   "id": "84e17025-ade2-4f06-9ec9-50009f86c289",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>order_id</th>\n",
       "      <th>product_id</th>\n",
       "      <th>quantity</th>\n",
       "      <th>unit_price</th>\n",
       "      <th>subtotal</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>45999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>2999.0</td>\n",
       "      <td>5998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>7</td>\n",
       "      <td>1</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>52999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>5</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>650.0</td>\n",
       "      <td>1950.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>6</td>\n",
       "      <td>12</td>\n",
       "      <td>1</td>\n",
       "      <td>12999.0</td>\n",
       "      <td>12999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>7</td>\n",
       "      <td>5</td>\n",
       "      <td>2</td>\n",
       "      <td>1999.0</td>\n",
       "      <td>3998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>9</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>4599.0</td>\n",
       "      <td>4599.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>10</td>\n",
       "      <td>6</td>\n",
       "      <td>5</td>\n",
       "      <td>899.0</td>\n",
       "      <td>4495.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>11</td>\n",
       "      <td>14</td>\n",
       "      <td>1</td>\n",
       "      <td>69999.0</td>\n",
       "      <td>69999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>12</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>52999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>13</td>\n",
       "      <td>15</td>\n",
       "      <td>3</td>\n",
       "      <td>450.0</td>\n",
       "      <td>1350.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>14</td>\n",
       "      <td>19</td>\n",
       "      <td>2</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>2998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>15</td>\n",
       "      <td>8</td>\n",
       "      <td>3</td>\n",
       "      <td>1299.0</td>\n",
       "      <td>3897.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>17</td>\n",
       "      <td>16</td>\n",
       "      <td>1</td>\n",
       "      <td>32999.0</td>\n",
       "      <td>32999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>18</td>\n",
       "      <td>20</td>\n",
       "      <td>2</td>\n",
       "      <td>1899.0</td>\n",
       "      <td>3798.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>19</td>\n",
       "      <td>18</td>\n",
       "      <td>10</td>\n",
       "      <td>120.0</td>\n",
       "      <td>1200.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>20</td>\n",
       "      <td>10</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>45999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>21</td>\n",
       "      <td>17</td>\n",
       "      <td>2</td>\n",
       "      <td>2999.0</td>\n",
       "      <td>5998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>22</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>45999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>23</td>\n",
       "      <td>19</td>\n",
       "      <td>3</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>4497.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>24</td>\n",
       "      <td>9</td>\n",
       "      <td>5</td>\n",
       "      <td>650.0</td>\n",
       "      <td>3250.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>26</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>4599.0</td>\n",
       "      <td>4599.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>27</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>3499.0</td>\n",
       "      <td>6998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>28</td>\n",
       "      <td>15</td>\n",
       "      <td>4</td>\n",
       "      <td>450.0</td>\n",
       "      <td>1800.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>29</td>\n",
       "      <td>7</td>\n",
       "      <td>1</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>52999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>31</td>\n",
       "      <td>12</td>\n",
       "      <td>1</td>\n",
       "      <td>12999.0</td>\n",
       "      <td>12999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>32</td>\n",
       "      <td>16</td>\n",
       "      <td>1</td>\n",
       "      <td>32999.0</td>\n",
       "      <td>32999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>33</td>\n",
       "      <td>5</td>\n",
       "      <td>2</td>\n",
       "      <td>1999.0</td>\n",
       "      <td>3998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>34</td>\n",
       "      <td>8</td>\n",
       "      <td>2</td>\n",
       "      <td>1299.0</td>\n",
       "      <td>2598.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>35</td>\n",
       "      <td>18</td>\n",
       "      <td>8</td>\n",
       "      <td>120.0</td>\n",
       "      <td>960.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>36</td>\n",
       "      <td>14</td>\n",
       "      <td>1</td>\n",
       "      <td>69999.0</td>\n",
       "      <td>69999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>37</td>\n",
       "      <td>6</td>\n",
       "      <td>4</td>\n",
       "      <td>899.0</td>\n",
       "      <td>3596.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>38</td>\n",
       "      <td>20</td>\n",
       "      <td>1</td>\n",
       "      <td>1899.0</td>\n",
       "      <td>1899.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>39</td>\n",
       "      <td>19</td>\n",
       "      <td>2</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>2998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>40</td>\n",
       "      <td>13</td>\n",
       "      <td>1</td>\n",
       "      <td>5499.0</td>\n",
       "      <td>5499.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    order_id  product_id  quantity  unit_price  subtotal\n",
       "0          1           1         1     45999.0   45999.0\n",
       "1          2           4         2      2999.0    5998.0\n",
       "2          3           7         1     52999.0   52999.0\n",
       "3          5           9         3       650.0    1950.0\n",
       "4          6          12         1     12999.0   12999.0\n",
       "5          7           5         2      1999.0    3998.0\n",
       "6          9          11         1      4599.0    4599.0\n",
       "7         10           6         5       899.0    4495.0\n",
       "8         11          14         1     69999.0   69999.0\n",
       "9         12           3         1     52999.0   52999.0\n",
       "10        13          15         3       450.0    1350.0\n",
       "11        14          19         2      1499.0    2998.0\n",
       "12        15           8         3      1299.0    3897.0\n",
       "13        17          16         1     32999.0   32999.0\n",
       "14        18          20         2      1899.0    3798.0\n",
       "15        19          18        10       120.0    1200.0\n",
       "16        20          10         1     45999.0   45999.0\n",
       "17        21          17         2      2999.0    5998.0\n",
       "18        22           1         1     45999.0   45999.0\n",
       "19        23          19         3      1499.0    4497.0\n",
       "20        24           9         5       650.0    3250.0\n",
       "21        26          11         1      4599.0    4599.0\n",
       "22        27           2         2      3499.0    6998.0\n",
       "23        28          15         4       450.0    1800.0\n",
       "24        29           7         1     52999.0   52999.0\n",
       "25        31          12         1     12999.0   12999.0\n",
       "26        32          16         1     32999.0   32999.0\n",
       "27        33           5         2      1999.0    3998.0\n",
       "28        34           8         2      1299.0    2598.0\n",
       "29        35          18         8       120.0     960.0\n",
       "30        36          14         1     69999.0   69999.0\n",
       "31        37           6         4       899.0    3596.0\n",
       "32        38          20         1      1899.0    1899.0\n",
       "33        39          19         2      1499.0    2998.0\n",
       "34        40          13         1      5499.0    5499.0"
      ]
     },
     "execution_count": 109,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Checking results to make sure there are no NaN cells\n",
    "order_items1_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 136,
   "id": "a8bd2d79-5dc9-4158-89ea-75e9297982e9",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Creating Lookup Dictionaries to map order_id from orders table to order_items table as FK . \n",
    "orders1_db = pd.read_sql(\"SELECT order_id FROM orders\", engine)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 137,
   "id": "85a79860-46ec-4c55-b424-3d67e3d3c736",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Merging and keeping only FK mappable rows\n",
    "order_items1_df = order_items1_df.merge(\n",
    "    orders1_db, left_on=\"order_id\", right_on=\"order_id\", how=\"inner\"\n",
    ")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 138,
   "id": "5a02f18c-849c-4cee-b2b5-4f5ce639df76",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>order_id</th>\n",
       "      <th>product_id</th>\n",
       "      <th>quantity</th>\n",
       "      <th>unit_price</th>\n",
       "      <th>subtotal</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>45999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>2999.0</td>\n",
       "      <td>5998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>7</td>\n",
       "      <td>1</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>52999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>5</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>650.0</td>\n",
       "      <td>1950.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>6</td>\n",
       "      <td>12</td>\n",
       "      <td>1</td>\n",
       "      <td>12999.0</td>\n",
       "      <td>12999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>7</td>\n",
       "      <td>5</td>\n",
       "      <td>2</td>\n",
       "      <td>1999.0</td>\n",
       "      <td>3998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>9</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>4599.0</td>\n",
       "      <td>4599.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>10</td>\n",
       "      <td>6</td>\n",
       "      <td>5</td>\n",
       "      <td>899.0</td>\n",
       "      <td>4495.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>11</td>\n",
       "      <td>14</td>\n",
       "      <td>1</td>\n",
       "      <td>69999.0</td>\n",
       "      <td>69999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>12</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>52999.0</td>\n",
       "      <td>52999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>13</td>\n",
       "      <td>15</td>\n",
       "      <td>3</td>\n",
       "      <td>450.0</td>\n",
       "      <td>1350.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>14</td>\n",
       "      <td>19</td>\n",
       "      <td>2</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>2998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>15</td>\n",
       "      <td>8</td>\n",
       "      <td>3</td>\n",
       "      <td>1299.0</td>\n",
       "      <td>3897.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>17</td>\n",
       "      <td>16</td>\n",
       "      <td>1</td>\n",
       "      <td>32999.0</td>\n",
       "      <td>32999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>18</td>\n",
       "      <td>20</td>\n",
       "      <td>2</td>\n",
       "      <td>1899.0</td>\n",
       "      <td>3798.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>19</td>\n",
       "      <td>18</td>\n",
       "      <td>10</td>\n",
       "      <td>120.0</td>\n",
       "      <td>1200.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>20</td>\n",
       "      <td>10</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>45999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>21</td>\n",
       "      <td>17</td>\n",
       "      <td>2</td>\n",
       "      <td>2999.0</td>\n",
       "      <td>5998.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>22</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>45999.0</td>\n",
       "      <td>45999.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>23</td>\n",
       "      <td>19</td>\n",
       "      <td>3</td>\n",
       "      <td>1499.0</td>\n",
       "      <td>4497.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>24</td>\n",
       "      <td>9</td>\n",
       "      <td>5</td>\n",
       "      <td>650.0</td>\n",
       "      <td>3250.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>26</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>4599.0</td>\n",
       "      <td>4599.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>27</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>3499.0</td>\n",
       "      <td>6998.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    order_id  product_id  quantity  unit_price  subtotal\n",
       "0          1           1         1     45999.0   45999.0\n",
       "1          2           4         2      2999.0    5998.0\n",
       "2          3           7         1     52999.0   52999.0\n",
       "3          5           9         3       650.0    1950.0\n",
       "4          6          12         1     12999.0   12999.0\n",
       "5          7           5         2      1999.0    3998.0\n",
       "6          9          11         1      4599.0    4599.0\n",
       "7         10           6         5       899.0    4495.0\n",
       "8         11          14         1     69999.0   69999.0\n",
       "9         12           3         1     52999.0   52999.0\n",
       "10        13          15         3       450.0    1350.0\n",
       "11        14          19         2      1499.0    2998.0\n",
       "12        15           8         3      1299.0    3897.0\n",
       "13        17          16         1     32999.0   32999.0\n",
       "14        18          20         2      1899.0    3798.0\n",
       "15        19          18        10       120.0    1200.0\n",
       "16        20          10         1     45999.0   45999.0\n",
       "17        21          17         2      2999.0    5998.0\n",
       "18        22           1         1     45999.0   45999.0\n",
       "19        23          19         3      1499.0    4497.0\n",
       "20        24           9         5       650.0    3250.0\n",
       "21        26          11         1      4599.0    4599.0\n",
       "22        27           2         2      3499.0    6998.0"
      ]
     },
     "execution_count": 138,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "order_items1_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 139,
   "id": "f9d012bc-8266-4a51-97ae-eb4ef48e29fb",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "✅ order_items loaded successfully\n"
     ]
    }
   ],
   "source": [
    "# Loading into Mysql\n",
    "order_items1_df.to_sql(\n",
    "    \"order_items\",     \n",
    "    engine,\n",
    "    if_exists=\"append\",\n",
    "    index=False,\n",
    "    method=\"multi\"\n",
    ")\n",
    "\n",
    "print(\"✅ order_items loaded successfully\")\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e2744429-0682-44b0-abdb-18dafc762a18",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
